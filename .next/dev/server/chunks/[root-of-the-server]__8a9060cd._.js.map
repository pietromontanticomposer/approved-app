{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///Users/pietromontanti/Desktop/approved-clean/Approved/lib/supabaseAdmin.ts"],"sourcesContent":["import { createClient } from \"@supabase/supabase-js\";\n\nconst supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL;\nconst supabaseServiceKey = process.env.SUPABASE_SERVICE_ROLE_KEY;\n\nif (!supabaseUrl || !supabaseServiceKey) {\n  throw new Error(\n    \"Missing NEXT_PUBLIC_SUPABASE_URL or SUPABASE_SERVICE_ROLE_KEY in environment.\"\n  );\n}\n\n// Admin client â€” use only on the server\nexport const supabaseAdmin = createClient(supabaseUrl, supabaseServiceKey, {\n  auth: { persistSession: false },\n});\n"],"names":[],"mappings":";;;;AAAA;;AAEA,MAAM;AACN,MAAM,qBAAqB,QAAQ,GAAG,CAAC,yBAAyB;AAEhE,IAAI,CAAC,eAAe,CAAC,oBAAoB;IACvC,MAAM,IAAI,MACR;AAEJ;AAGO,MAAM,gBAAgB,IAAA,yLAAY,EAAC,aAAa,oBAAoB;IACzE,MAAM;QAAE,gBAAgB;IAAM;AAChC"}},
    {"offset": {"line": 66, "column": 0}, "map": {"version":3,"sources":["file:///Users/pietromontanti/Desktop/approved-clean/Approved/app/api/invites/accept/route.ts"],"sourcesContent":["import { NextResponse } from \"next/server\";\nimport { supabaseAdmin } from \"@/lib/supabaseAdmin\";\n\n/**\n * POST /api/invites/accept\n * Body: { invite_token }\n * Header: x-actor-id or Authorization: Bearer <token>\n * Calls the DB RPC `accept_invite` using admin client on behalf of actorId.\n */\nexport async function POST(req: Request) {\n  try {\n    const auth = req.headers.get('authorization') || '';\n    let actorId: string | null = null;\n    if (auth.toLowerCase().startsWith('bearer ')) {\n      const token = auth.split(' ')[1];\n      try {\n        const { data: verified, error: verifyErr } = await supabaseAdmin.auth.getUser(token);\n        if (!verifyErr && verified?.user?.id) actorId = verified.user.id;\n      } catch (e) {\n        console.warn('[/api/invites/accept] token verify error', e);\n      }\n    }\n\n    if (!actorId) actorId = req.headers.get('x-actor-id');\n\n    const body = await req.json();\n    const inviteToken = body?.invite_token;\n    if (!inviteToken) return NextResponse.json({ error: 'invite_token required' }, { status: 400 });\n    if (!actorId) return NextResponse.json({ error: 'actor id required' }, { status: 403 });\n\n    const { data, error } = await supabaseAdmin.rpc('accept_invite', { invite_token: inviteToken, accepting_user_id: actorId });\n    if (error) {\n      console.error('accept_invite RPC error', error);\n      return NextResponse.json({ error: error.message }, { status: 500 });\n    }\n\n    return NextResponse.json(data);\n  } catch (err: any) {\n    console.error('[/api/invites/accept] Error', err);\n    return NextResponse.json({ error: err.message || 'Unexpected' }, { status: 500 });\n  }\n}\n"],"names":[],"mappings":";;;;AAAA;AACA;;;AAQO,eAAe,KAAK,GAAY;IACrC,IAAI;QACF,MAAM,OAAO,IAAI,OAAO,CAAC,GAAG,CAAC,oBAAoB;QACjD,IAAI,UAAyB;QAC7B,IAAI,KAAK,WAAW,GAAG,UAAU,CAAC,YAAY;YAC5C,MAAM,QAAQ,KAAK,KAAK,CAAC,IAAI,CAAC,EAAE;YAChC,IAAI;gBACF,MAAM,EAAE,MAAM,QAAQ,EAAE,OAAO,SAAS,EAAE,GAAG,MAAM,uIAAa,CAAC,IAAI,CAAC,OAAO,CAAC;gBAC9E,IAAI,CAAC,aAAa,UAAU,MAAM,IAAI,UAAU,SAAS,IAAI,CAAC,EAAE;YAClE,EAAE,OAAO,GAAG;gBACV,QAAQ,IAAI,CAAC,4CAA4C;YAC3D;QACF;QAEA,IAAI,CAAC,SAAS,UAAU,IAAI,OAAO,CAAC,GAAG,CAAC;QAExC,MAAM,OAAO,MAAM,IAAI,IAAI;QAC3B,MAAM,cAAc,MAAM;QAC1B,IAAI,CAAC,aAAa,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAwB,GAAG;YAAE,QAAQ;QAAI;QAC7F,IAAI,CAAC,SAAS,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAoB,GAAG;YAAE,QAAQ;QAAI;QAErF,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,GAAG,MAAM,uIAAa,CAAC,GAAG,CAAC,iBAAiB;YAAE,cAAc;YAAa,mBAAmB;QAAQ;QACzH,IAAI,OAAO;YACT,QAAQ,KAAK,CAAC,2BAA2B;YACzC,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO,MAAM,OAAO;YAAC,GAAG;gBAAE,QAAQ;YAAI;QACnE;QAEA,OAAO,gJAAY,CAAC,IAAI,CAAC;IAC3B,EAAE,OAAO,KAAU;QACjB,QAAQ,KAAK,CAAC,+BAA+B;QAC7C,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO,IAAI,OAAO,IAAI;QAAa,GAAG;YAAE,QAAQ;QAAI;IACjF;AACF"}}]
}