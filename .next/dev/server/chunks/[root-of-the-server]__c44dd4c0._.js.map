{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///Users/pietromontanti/Desktop/approved-clean/Approved/lib/supabaseAdmin.ts"],"sourcesContent":["import { createClient } from \"@supabase/supabase-js\";\n\nconst supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL;\nconst supabaseServiceKey = process.env.SUPABASE_SERVICE_ROLE_KEY;\n\nif (!supabaseUrl || !supabaseServiceKey) {\n  throw new Error(\n    \"Missing NEXT_PUBLIC_SUPABASE_URL or SUPABASE_SERVICE_ROLE_KEY in environment.\"\n  );\n}\n\n// Admin client â€” use only on the server\nexport const supabaseAdmin = createClient(supabaseUrl, supabaseServiceKey, {\n  auth: { persistSession: false },\n});\n"],"names":[],"mappings":";;;;AAAA;;AAEA,MAAM;AACN,MAAM,qBAAqB,QAAQ,GAAG,CAAC,yBAAyB;AAEhE,IAAI,CAAC,eAAe,CAAC,oBAAoB;IACvC,MAAM,IAAI,MACR;AAEJ;AAGO,MAAM,gBAAgB,IAAA,yLAAY,EAAC,aAAa,oBAAoB;IACzE,MAAM;QAAE,gBAAgB;IAAM;AAChC"}},
    {"offset": {"line": 66, "column": 0}, "map": {"version":3,"sources":["file:///Users/pietromontanti/Desktop/approved-clean/Approved/app/api/invites/details/route.ts"],"sourcesContent":["import { NextResponse } from \"next/server\";\nimport { supabaseAdmin } from \"@/lib/supabaseAdmin\";\n\n/**\n * GET /api/invites/details?token=uuid\n * Public endpoint that returns invite details using admin client (bypasses broken DB RPC)\n */\nexport async function GET(req: Request) {\n  try {\n    const url = new URL(req.url);\n    const token = url.searchParams.get(\"token\");\n    if (!token) return NextResponse.json({ error: \"token required\" }, { status: 400 });\n\n    const { data: linkData, error } = await supabaseAdmin\n      .from(\"invites\")\n      .select(`id, team_id, project_id, email, role, invited_by, is_link_invite, expires_at, used_at, revoked`)\n      .eq(\"id\", token)\n      .maybeSingle();\n\n    if (error) {\n      console.error('[GET /api/invites/details] DB error', error);\n      return NextResponse.json({ error: error.message }, { status: 500 });\n    }\n\n    if (!linkData) return NextResponse.json({ error: \"Invite not found\" }, { status: 404 });\n\n    // Validate not revoked/used/expired\n    if (linkData.revoked) return NextResponse.json({ error: \"Invite revoked\" }, { status: 410 });\n    if (linkData.used_at) return NextResponse.json({ error: \"Invite already used\" }, { status: 410 });\n    if (linkData.expires_at && new Date(linkData.expires_at) < new Date()) return NextResponse.json({ error: \"Invite expired\" }, { status: 410 });\n\n    // Fetch team and project names\n    const [{ data: team }, { data: project }, { data: invitedBy }] = await Promise.all([\n      supabaseAdmin.from('teams').select('id,name').eq('id', linkData.team_id).maybeSingle(),\n      linkData.project_id ? supabaseAdmin.from('projects').select('id,name').eq('id', linkData.project_id).maybeSingle() : Promise.resolve({ data: null }),\n      linkData.invited_by ? supabaseAdmin.from('auth.users').select('id,email').eq('id', linkData.invited_by).maybeSingle() : Promise.resolve({ data: null })\n    ]);\n\n    const result = {\n      id: linkData.id,\n      team_id: linkData.team_id,\n      team_name: team?.name || null,\n      project_id: linkData.project_id,\n      project_name: project?.name || null,\n      email: linkData.email,\n      role: linkData.role,\n      invited_by_email: invitedBy?.email || null,\n      is_link_invite: !!linkData.is_link_invite,\n      expires_at: linkData.expires_at,\n      is_expired: linkData.expires_at ? (new Date(linkData.expires_at) < new Date()) : false,\n      is_used: !!linkData.used_at,\n      is_revoked: !!linkData.revoked,\n    };\n\n    return NextResponse.json(result);\n  } catch (err: any) {\n    console.error('[GET /api/invites/details] Error', err);\n    return NextResponse.json({ error: err.message || 'Unexpected error' }, { status: 500 });\n  }\n}\n"],"names":[],"mappings":";;;;AAAA;AACA;;;AAMO,eAAe,IAAI,GAAY;IACpC,IAAI;QACF,MAAM,MAAM,IAAI,IAAI,IAAI,GAAG;QAC3B,MAAM,QAAQ,IAAI,YAAY,CAAC,GAAG,CAAC;QACnC,IAAI,CAAC,OAAO,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAiB,GAAG;YAAE,QAAQ;QAAI;QAEhF,MAAM,EAAE,MAAM,QAAQ,EAAE,KAAK,EAAE,GAAG,MAAM,uIAAa,CAClD,IAAI,CAAC,WACL,MAAM,CAAC,CAAC,8FAA8F,CAAC,EACvG,EAAE,CAAC,MAAM,OACT,WAAW;QAEd,IAAI,OAAO;YACT,QAAQ,KAAK,CAAC,uCAAuC;YACrD,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO,MAAM,OAAO;YAAC,GAAG;gBAAE,QAAQ;YAAI;QACnE;QAEA,IAAI,CAAC,UAAU,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAmB,GAAG;YAAE,QAAQ;QAAI;QAErF,oCAAoC;QACpC,IAAI,SAAS,OAAO,EAAE,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAiB,GAAG;YAAE,QAAQ;QAAI;QAC1F,IAAI,SAAS,OAAO,EAAE,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAsB,GAAG;YAAE,QAAQ;QAAI;QAC/F,IAAI,SAAS,UAAU,IAAI,IAAI,KAAK,SAAS,UAAU,IAAI,IAAI,QAAQ,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAiB,GAAG;YAAE,QAAQ;QAAI;QAE3I,+BAA+B;QAC/B,MAAM,CAAC,EAAE,MAAM,IAAI,EAAE,EAAE,EAAE,MAAM,OAAO,EAAE,EAAE,EAAE,MAAM,SAAS,EAAE,CAAC,GAAG,MAAM,QAAQ,GAAG,CAAC;YACjF,uIAAa,CAAC,IAAI,CAAC,SAAS,MAAM,CAAC,WAAW,EAAE,CAAC,MAAM,SAAS,OAAO,EAAE,WAAW;YACpF,SAAS,UAAU,GAAG,uIAAa,CAAC,IAAI,CAAC,YAAY,MAAM,CAAC,WAAW,EAAE,CAAC,MAAM,SAAS,UAAU,EAAE,WAAW,KAAK,QAAQ,OAAO,CAAC;gBAAE,MAAM;YAAK;YAClJ,SAAS,UAAU,GAAG,uIAAa,CAAC,IAAI,CAAC,cAAc,MAAM,CAAC,YAAY,EAAE,CAAC,MAAM,SAAS,UAAU,EAAE,WAAW,KAAK,QAAQ,OAAO,CAAC;gBAAE,MAAM;YAAK;SACtJ;QAED,MAAM,SAAS;YACb,IAAI,SAAS,EAAE;YACf,SAAS,SAAS,OAAO;YACzB,WAAW,MAAM,QAAQ;YACzB,YAAY,SAAS,UAAU;YAC/B,cAAc,SAAS,QAAQ;YAC/B,OAAO,SAAS,KAAK;YACrB,MAAM,SAAS,IAAI;YACnB,kBAAkB,WAAW,SAAS;YACtC,gBAAgB,CAAC,CAAC,SAAS,cAAc;YACzC,YAAY,SAAS,UAAU;YAC/B,YAAY,SAAS,UAAU,GAAI,IAAI,KAAK,SAAS,UAAU,IAAI,IAAI,SAAU;YACjF,SAAS,CAAC,CAAC,SAAS,OAAO;YAC3B,YAAY,CAAC,CAAC,SAAS,OAAO;QAChC;QAEA,OAAO,gJAAY,CAAC,IAAI,CAAC;IAC3B,EAAE,OAAO,KAAU;QACjB,QAAQ,KAAK,CAAC,oCAAoC;QAClD,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO,IAAI,OAAO,IAAI;QAAmB,GAAG;YAAE,QAAQ;QAAI;IACvF;AACF"}}]
}