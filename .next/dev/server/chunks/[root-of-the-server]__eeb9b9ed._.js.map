{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///Users/pietromontanti/Desktop/approved-clean/Approved/lib/supabaseAdmin.ts"],"sourcesContent":["import { createClient } from \"@supabase/supabase-js\";\n\nconst supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL;\nconst supabaseServiceKey = process.env.SUPABASE_SERVICE_ROLE_KEY;\n\nif (!supabaseUrl || !supabaseServiceKey) {\n  throw new Error(\n    \"Missing NEXT_PUBLIC_SUPABASE_URL or SUPABASE_SERVICE_ROLE_KEY in environment.\"\n  );\n}\n\n// Admin client â€” use only on the server\nexport const supabaseAdmin = createClient(supabaseUrl, supabaseServiceKey, {\n  auth: { persistSession: false },\n});\n"],"names":[],"mappings":";;;;AAAA;;AAEA,MAAM;AACN,MAAM,qBAAqB,QAAQ,GAAG,CAAC,yBAAyB;AAEhE,IAAI,CAAC,eAAe,CAAC,oBAAoB;IACvC,MAAM,IAAI,MACR;AAEJ;AAGO,MAAM,gBAAgB,IAAA,yLAAY,EAAC,aAAa,oBAAoB;IACzE,MAAM;QAAE,gBAAgB;IAAM;AAChC"}},
    {"offset": {"line": 66, "column": 0}, "map": {"version":3,"sources":["file:///Users/pietromontanti/Desktop/approved-clean/Approved/app/api/versions/update/route.ts"],"sourcesContent":["import { NextResponse } from \"next/server\";\nimport { supabaseAdmin } from \"@/lib/supabaseAdmin\";\n\nexport const runtime = \"nodejs\";\n\nexport async function POST(req: Request) {\n  try {\n    const body = await req.json();\n    const { versionId, updates, versionFiles } = body as any;\n\n    if (!versionId) {\n      return NextResponse.json({ error: \"Missing versionId\" }, { status: 400 });\n    }\n\n    const { data: updatedVersion, error: updateError } = await supabaseAdmin\n      .from(\"versions\")\n      .update(updates)\n      .eq(\"id\", versionId)\n      .select()\n      .single();\n    if (updateError) throw updateError;\n\n    // Optionally insert new deliverable files\n    let filesInserted: any[] = [];\n    if (Array.isArray(versionFiles) && versionFiles.length > 0) {\n      const filesToInsert = versionFiles.map((f: any) => ({\n        version_id: versionId,\n        name: f.name,\n        type: f.type ?? null,\n        url: f.url ?? null,\n        size: f.size ?? null,\n      }));\n      const { data: insertedFiles, error: filesError } = await supabaseAdmin\n        .from(\"version_files\")\n        .insert(filesToInsert)\n        .select();\n      if (filesError) throw filesError;\n      filesInserted = insertedFiles;\n    }\n\n    return NextResponse.json({ version: updatedVersion, files: filesInserted });\n  } catch (err: any) {\n    console.error(\"[POST /api/versions/update]\", err);\n    return NextResponse.json({ error: String(err) }, { status: 500 });\n  }\n}\n"],"names":[],"mappings":";;;;;;AAAA;AACA;;;AAEO,MAAM,UAAU;AAEhB,eAAe,KAAK,GAAY;IACrC,IAAI;QACF,MAAM,OAAO,MAAM,IAAI,IAAI;QAC3B,MAAM,EAAE,SAAS,EAAE,OAAO,EAAE,YAAY,EAAE,GAAG;QAE7C,IAAI,CAAC,WAAW;YACd,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAoB,GAAG;gBAAE,QAAQ;YAAI;QACzE;QAEA,MAAM,EAAE,MAAM,cAAc,EAAE,OAAO,WAAW,EAAE,GAAG,MAAM,uIAAa,CACrE,IAAI,CAAC,YACL,MAAM,CAAC,SACP,EAAE,CAAC,MAAM,WACT,MAAM,GACN,MAAM;QACT,IAAI,aAAa,MAAM;QAEvB,0CAA0C;QAC1C,IAAI,gBAAuB,EAAE;QAC7B,IAAI,MAAM,OAAO,CAAC,iBAAiB,aAAa,MAAM,GAAG,GAAG;YAC1D,MAAM,gBAAgB,aAAa,GAAG,CAAC,CAAC,IAAW,CAAC;oBAClD,YAAY;oBACZ,MAAM,EAAE,IAAI;oBACZ,MAAM,EAAE,IAAI,IAAI;oBAChB,KAAK,EAAE,GAAG,IAAI;oBACd,MAAM,EAAE,IAAI,IAAI;gBAClB,CAAC;YACD,MAAM,EAAE,MAAM,aAAa,EAAE,OAAO,UAAU,EAAE,GAAG,MAAM,uIAAa,CACnE,IAAI,CAAC,iBACL,MAAM,CAAC,eACP,MAAM;YACT,IAAI,YAAY,MAAM;YACtB,gBAAgB;QAClB;QAEA,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,SAAS;YAAgB,OAAO;QAAc;IAC3E,EAAE,OAAO,KAAU;QACjB,QAAQ,KAAK,CAAC,+BAA+B;QAC7C,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO,OAAO;QAAK,GAAG;YAAE,QAAQ;QAAI;IACjE;AACF"}}]
}