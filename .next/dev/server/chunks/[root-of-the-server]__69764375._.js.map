{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///Users/pietromontanti/Desktop/approved-clean/Approved/lib/supabaseAdmin.ts"],"sourcesContent":["import { createClient } from \"@supabase/supabase-js\";\n\nconst supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL;\nconst supabaseServiceKey = process.env.SUPABASE_SERVICE_ROLE_KEY;\n\nif (!supabaseUrl || !supabaseServiceKey) {\n  throw new Error(\n    \"Missing NEXT_PUBLIC_SUPABASE_URL or SUPABASE_SERVICE_ROLE_KEY in environment.\"\n  );\n}\n\n// Admin client â€” use only on the server\nexport const supabaseAdmin = createClient(supabaseUrl, supabaseServiceKey, {\n  auth: { persistSession: false },\n});\n"],"names":[],"mappings":";;;;AAAA;;AAEA,MAAM;AACN,MAAM,qBAAqB,QAAQ,GAAG,CAAC,yBAAyB;AAEhE,IAAI,CAAC,eAAe,CAAC,oBAAoB;IACvC,MAAM,IAAI,MACR;AAEJ;AAGO,MAAM,gBAAgB,IAAA,yLAAY,EAAC,aAAa,oBAAoB;IACzE,MAAM;QAAE,gBAAgB;IAAM;AAChC"}},
    {"offset": {"line": 72, "column": 0}, "map": {"version":3,"sources":["file:///Users/pietromontanti/Desktop/approved-clean/Approved/app/api/share/details/route.ts"],"sourcesContent":["import { NextResponse } from \"next/server\";\nimport { supabaseAdmin } from \"@/lib/supabaseAdmin\";\nimport crypto from \"crypto\";\n\nexport async function GET(req: Request) {\n  try {\n    const url = new URL(req.url);\n    const shareId = url.searchParams.get('share_id') || '';\n    const token = url.searchParams.get('token') || '';\n\n    if (!shareId || !token) return NextResponse.json({ error: 'share_id and token required' }, { status: 400 });\n\n    const { data: linkData, error: linkErr } = await supabaseAdmin.from('share_links').select('*, projects(name)').eq('id', shareId).maybeSingle();\n    if (linkErr) {\n      console.warn('[GET /api/share/details] supabase error', linkErr);\n      return NextResponse.json({ error: 'Share link not found' }, { status: 404 });\n    }\n    if (!linkData) return NextResponse.json({ error: 'Share link not found' }, { status: 404 });\n    if (linkData.revoked_at) return NextResponse.json({ error: 'Share link revoked' }, { status: 410 });\n\n    if (linkData.expires_at && new Date(linkData.expires_at) < new Date()) return NextResponse.json({ error: 'Share link expired' }, { status: 410 });\n\n    const tokenHash = crypto.createHash('sha256').update(token).digest('hex');\n    if (tokenHash !== linkData.token_hash) return NextResponse.json({ error: 'Invalid token' }, { status: 403 });\n\n    // return minimal details for the client\n    const resp = {\n      found: true,\n      share_id: linkData.id,\n      project_id: linkData.project_id,\n      project_name: linkData.project_name || linkData.projects?.name || null,\n      role: linkData.role || 'view',\n      expires_at: linkData.expires_at || null,\n    };\n\n    return NextResponse.json(resp, { status: 200 });\n  } catch (err: any) {\n    console.error('[GET /api/share/details] Error', err);\n    return NextResponse.json({ error: err?.message || 'Unexpected error' }, { status: 500 });\n  }\n}\n"],"names":[],"mappings":";;;;AAAA;AACA;AACA;;;;AAEO,eAAe,IAAI,GAAY;IACpC,IAAI;QACF,MAAM,MAAM,IAAI,IAAI,IAAI,GAAG;QAC3B,MAAM,UAAU,IAAI,YAAY,CAAC,GAAG,CAAC,eAAe;QACpD,MAAM,QAAQ,IAAI,YAAY,CAAC,GAAG,CAAC,YAAY;QAE/C,IAAI,CAAC,WAAW,CAAC,OAAO,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAA8B,GAAG;YAAE,QAAQ;QAAI;QAEzG,MAAM,EAAE,MAAM,QAAQ,EAAE,OAAO,OAAO,EAAE,GAAG,MAAM,uIAAa,CAAC,IAAI,CAAC,eAAe,MAAM,CAAC,qBAAqB,EAAE,CAAC,MAAM,SAAS,WAAW;QAC5I,IAAI,SAAS;YACX,QAAQ,IAAI,CAAC,2CAA2C;YACxD,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAuB,GAAG;gBAAE,QAAQ;YAAI;QAC5E;QACA,IAAI,CAAC,UAAU,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAuB,GAAG;YAAE,QAAQ;QAAI;QACzF,IAAI,SAAS,UAAU,EAAE,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAqB,GAAG;YAAE,QAAQ;QAAI;QAEjG,IAAI,SAAS,UAAU,IAAI,IAAI,KAAK,SAAS,UAAU,IAAI,IAAI,QAAQ,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAqB,GAAG;YAAE,QAAQ;QAAI;QAE/I,MAAM,YAAY,gHAAM,CAAC,UAAU,CAAC,UAAU,MAAM,CAAC,OAAO,MAAM,CAAC;QACnE,IAAI,cAAc,SAAS,UAAU,EAAE,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAgB,GAAG;YAAE,QAAQ;QAAI;QAE1G,wCAAwC;QACxC,MAAM,OAAO;YACX,OAAO;YACP,UAAU,SAAS,EAAE;YACrB,YAAY,SAAS,UAAU;YAC/B,cAAc,SAAS,YAAY,IAAI,SAAS,QAAQ,EAAE,QAAQ;YAClE,MAAM,SAAS,IAAI,IAAI;YACvB,YAAY,SAAS,UAAU,IAAI;QACrC;QAEA,OAAO,gJAAY,CAAC,IAAI,CAAC,MAAM;YAAE,QAAQ;QAAI;IAC/C,EAAE,OAAO,KAAU;QACjB,QAAQ,KAAK,CAAC,kCAAkC;QAChD,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO,KAAK,WAAW;QAAmB,GAAG;YAAE,QAAQ;QAAI;IACxF;AACF"}}]
}