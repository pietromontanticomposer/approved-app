{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///Users/pietromontanti/Desktop/approved-clean/Approved/lib/supabaseAdmin.ts"],"sourcesContent":["import { createClient } from \"@supabase/supabase-js\";\n\nconst supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL;\nconst supabaseServiceKey = process.env.SUPABASE_SERVICE_ROLE_KEY;\n\nif (!supabaseUrl || !supabaseServiceKey) {\n  throw new Error(\n    \"Missing NEXT_PUBLIC_SUPABASE_URL or SUPABASE_SERVICE_ROLE_KEY in environment.\"\n  );\n}\n\n// Admin client â€” use only on the server\nexport const supabaseAdmin = createClient(supabaseUrl, supabaseServiceKey, {\n  auth: { persistSession: false },\n});\n"],"names":[],"mappings":";;;;AAAA;;AAEA,MAAM;AACN,MAAM,qBAAqB,QAAQ,GAAG,CAAC,yBAAyB;AAEhE,IAAI,CAAC,eAAe,CAAC,oBAAoB;IACvC,MAAM,IAAI,MACR;AAEJ;AAGO,MAAM,gBAAgB,IAAA,yLAAY,EAAC,aAAa,oBAAoB;IACzE,MAAM;QAAE,gBAAgB;IAAM;AAChC"}},
    {"offset": {"line": 66, "column": 0}, "map": {"version":3,"sources":["file:///Users/pietromontanti/Desktop/approved-clean/Approved/app/api/upload/route.ts"],"sourcesContent":["import { NextResponse } from \"next/server\";\nimport { supabaseAdmin } from \"@/lib/supabaseAdmin\";\n\nexport const runtime = \"nodejs\";\n\nconst STORAGE_BUCKET = process.env.NEXT_PUBLIC_SUPABASE_STORAGE_BUCKET || \"media\";\nconst SIGNED_URL_TTL_SECONDS = parseInt(\n  process.env.NEXT_PUBLIC_SUPABASE_SIGNED_TTL || \"7200\",\n  10\n);\n\nexport async function POST(req: Request) {\n  try {\n    const form = await req.formData();\n    const file = form.get(\"file\") as File | null;\n    const projectId = form.get(\"projectId\") as string | null;\n    const cueId = form.get(\"cueId\") as string | null;\n    const versionId = form.get(\"versionId\") as string | null;\n\n    if (!file) {\n      return NextResponse.json({ error: \"Missing file\" }, { status: 400 });\n    }\n\n    const name = file.name || `upload-${Date.now()}`;\n    const contentType = file.type || \"application/octet-stream\";\n\n    const buffer = Buffer.from(await file.arrayBuffer());\n\n    // Create path based on project/cue/version structure\n    let folder = \"uploads\";\n    if (projectId && cueId && versionId) {\n      folder = `projects/${projectId}/cues/${cueId}/versions/${versionId}`;\n    } else if (projectId) {\n      folder = `projects/${projectId}`;\n    }\n    \n    const path = `${folder}/${Date.now()}-${name}`;\n\n    console.log(\"[POST /api/upload] Uploading file:\", {\n      path,\n      size: file.size,\n      type: contentType,\n      projectId,\n      cueId,\n      versionId,\n    });\n\n    const { data, error } = await supabaseAdmin.storage\n      .from(STORAGE_BUCKET)\n      .upload(path, buffer, { contentType, upsert: false });\n\n    if (error) {\n      console.error(\"[POST /api/upload] Supabase storage error\", error);\n      return NextResponse.json({ error: error.message }, { status: 500 });\n    }\n\n    console.log(\"[POST /api/upload] File uploaded to:\", data.path);\n\n    // Generate signed URL\n    const { data: signedData, error: signError } = await supabaseAdmin.storage\n      .from(STORAGE_BUCKET)\n      .createSignedUrl(data.path, SIGNED_URL_TTL_SECONDS);\n\n    if (signError) {\n      console.warn(\"[POST /api/upload] Signed URL error (using public URL):\", signError);\n      // Fallback to public URL\n      const { data: publicData } = supabaseAdmin.storage.from(STORAGE_BUCKET).getPublicUrl(data.path);\n      return NextResponse.json({\n        success: true,\n        path: data.path,\n        mediaUrl: publicData?.publicUrl,\n      });\n    }\n\n    return NextResponse.json({\n      success: true,\n      path: data.path,\n      mediaUrl: signedData?.signedUrl,\n    });\n  } catch (err: any) {\n    console.error(\"[POST /api/upload] Unexpected error\", err);\n    return NextResponse.json({ error: String(err) }, { status: 500 });\n  }\n}\n"],"names":[],"mappings":";;;;;;AAAA;AACA;;;AAEO,MAAM,UAAU;AAEvB,MAAM,iBAAiB,QAAQ,GAAG,CAAC,mCAAmC,IAAI;AAC1E,MAAM,yBAAyB,SAC7B,QAAQ,GAAG,CAAC,+BAA+B,IAAI,QAC/C;AAGK,eAAe,KAAK,GAAY;IACrC,IAAI;QACF,MAAM,OAAO,MAAM,IAAI,QAAQ;QAC/B,MAAM,OAAO,KAAK,GAAG,CAAC;QACtB,MAAM,YAAY,KAAK,GAAG,CAAC;QAC3B,MAAM,QAAQ,KAAK,GAAG,CAAC;QACvB,MAAM,YAAY,KAAK,GAAG,CAAC;QAE3B,IAAI,CAAC,MAAM;YACT,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAe,GAAG;gBAAE,QAAQ;YAAI;QACpE;QAEA,MAAM,OAAO,KAAK,IAAI,IAAI,CAAC,OAAO,EAAE,KAAK,GAAG,IAAI;QAChD,MAAM,cAAc,KAAK,IAAI,IAAI;QAEjC,MAAM,SAAS,OAAO,IAAI,CAAC,MAAM,KAAK,WAAW;QAEjD,qDAAqD;QACrD,IAAI,SAAS;QACb,IAAI,aAAa,SAAS,WAAW;YACnC,SAAS,CAAC,SAAS,EAAE,UAAU,MAAM,EAAE,MAAM,UAAU,EAAE,WAAW;QACtE,OAAO,IAAI,WAAW;YACpB,SAAS,CAAC,SAAS,EAAE,WAAW;QAClC;QAEA,MAAM,OAAO,GAAG,OAAO,CAAC,EAAE,KAAK,GAAG,GAAG,CAAC,EAAE,MAAM;QAE9C,QAAQ,GAAG,CAAC,sCAAsC;YAChD;YACA,MAAM,KAAK,IAAI;YACf,MAAM;YACN;YACA;YACA;QACF;QAEA,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,GAAG,MAAM,uIAAa,CAAC,OAAO,CAChD,IAAI,CAAC,gBACL,MAAM,CAAC,MAAM,QAAQ;YAAE;YAAa,QAAQ;QAAM;QAErD,IAAI,OAAO;YACT,QAAQ,KAAK,CAAC,6CAA6C;YAC3D,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO,MAAM,OAAO;YAAC,GAAG;gBAAE,QAAQ;YAAI;QACnE;QAEA,QAAQ,GAAG,CAAC,wCAAwC,KAAK,IAAI;QAE7D,sBAAsB;QACtB,MAAM,EAAE,MAAM,UAAU,EAAE,OAAO,SAAS,EAAE,GAAG,MAAM,uIAAa,CAAC,OAAO,CACvE,IAAI,CAAC,gBACL,eAAe,CAAC,KAAK,IAAI,EAAE;QAE9B,IAAI,WAAW;YACb,QAAQ,IAAI,CAAC,2DAA2D;YACxE,yBAAyB;YACzB,MAAM,EAAE,MAAM,UAAU,EAAE,GAAG,uIAAa,CAAC,OAAO,CAAC,IAAI,CAAC,gBAAgB,YAAY,CAAC,KAAK,IAAI;YAC9F,OAAO,gJAAY,CAAC,IAAI,CAAC;gBACvB,SAAS;gBACT,MAAM,KAAK,IAAI;gBACf,UAAU,YAAY;YACxB;QACF;QAEA,OAAO,gJAAY,CAAC,IAAI,CAAC;YACvB,SAAS;YACT,MAAM,KAAK,IAAI;YACf,UAAU,YAAY;QACxB;IACF,EAAE,OAAO,KAAU;QACjB,QAAQ,KAAK,CAAC,uCAAuC;QACrD,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO,OAAO;QAAK,GAAG;YAAE,QAAQ;QAAI;IACjE;AACF"}}]
}