{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 52, "column": 0}, "map": {"version":3,"sources":["file:///Users/pietromontanti/Desktop/approved-clean/Approved/lib/supabaseAdmin.ts"],"sourcesContent":["import { createClient } from \"@supabase/supabase-js\";\n\nconst supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL;\nconst supabaseServiceKey = process.env.SUPABASE_SERVICE_ROLE_KEY;\n\n// Export a variable and assign it below to avoid `export` inside conditionals\nexport let supabaseAdmin: any = null;\n\n// If real env vars are present, use real client. Otherwise, if testing is enabled,\n// provide a lightweight in-memory fake client to allow local tests without secrets.\nif (supabaseUrl && supabaseServiceKey) {\n  // Admin client — use only on the server\n  supabaseAdmin = createClient(supabaseUrl, supabaseServiceKey, {\n    auth: { persistSession: false },\n  });\n} else if (process.env.APP_ALLOW_FAKE_SUPABASE === '1') {\n  // Simple in-memory fake DB with minimal API surface used by the server routes.\n  type Row = Record<string, any>;\n  const db: Record<string, Row[]> = {\n    projects: [\n      { id: 'p1', team_id: 't1', owner_id: 'owner-1', name: 'Test Project' },\n    ],\n    share_links: [],\n    project_members: [],\n    team_members: [ { team_id: 't1', user_id: 'owner-1', role: 'owner' } ],\n    audit_logs: [],\n  };\n\n  const { v4: uuidv4 } = require('uuid');\n  function clone(obj: any) { return JSON.parse(JSON.stringify(obj)); }\n\n  function createFrom(tableName: string) {\n    const q: any = {\n      _table: tableName,\n      _select: '*',\n      _where: [] as Array<{k:string,v:any}>,\n      _limit: null as number | null,\n      select(cols?: string) { q._select = cols || '*'; return q; },\n      eq(k: string, v: any) { q._where.push({k,v}); return q; },\n      limit(n: number) { q._limit = n; return q; },\n      maybeSingle: async () => {\n        const rows = db[tableName] || [];\n        const filtered = rows.filter(r => q._where.every(w => String(r[w.k]) === String(w.v)));\n        return { data: filtered.length>0 ? clone(filtered[0]) : null, error: null };\n      },\n      insert: (payload: any) => {\n        const rows = db[tableName] || (db[tableName] = []);\n        const toInsert = Array.isArray(payload) ? payload : [payload];\n        const inserted = toInsert.map((p: any) => {\n          const row = Object.assign({}, p);\n          if (!row.id) row.id = uuidv4();\n          row.created_at = new Date().toISOString();\n          rows.push(row);\n          return row;\n        });\n        return {\n          data: inserted,\n          error: null,\n          select: () => ({\n            single: async () => ({ data: inserted[0], error: null })\n          })\n        };\n      },\n      update: (payload: any) => {\n        // return chainable object supporting .eq(k,v)\n        return {\n          eq: async (k: string, v: any) => {\n            const rows = db[tableName] || [];\n            let updatedCount = 0;\n            for (const r of rows) {\n              if (q._where.every(w => String(r[w.k]) === String(w.v)) && String(r[k]) === String(v)) {\n                Object.assign(r, payload);\n                updatedCount++;\n              }\n            }\n            return { data: updatedCount>0 ? rows.filter(r => (q._where.every(w => String(r[w.k]) === String(w.v)) && String(r[k]) === String(v))) : [], error: null };\n          }\n        };\n      },\n      upsert: async (payload: any, opts?: any) => {\n        const rows = db[tableName] || (db[tableName] = []);\n        // naive onConflict by project_id,member_id\n        const existing = rows.find(r => r.project_id === payload.project_id && r.member_id === payload.member_id);\n        if (existing) {\n          Object.assign(existing, payload);\n          return { data: [existing], error: null };\n        }\n        const row = Object.assign({}, payload);\n        if (!row.id) row.id = uuidv4();\n        rows.push(row);\n        return { data: [row], error: null };\n      },\n      single: async () => {\n        const rows = db[tableName] || [];\n        const filtered = rows.filter(r => q._where.every(w => String(r[w.k]) === String(w.v)));\n        return { data: filtered[0] || null, error: null };\n      }\n    };\n    return q;\n  }\n\n  const fakeAdmin = {\n    from: (table: string) => createFrom(table),\n  };\n\n  supabaseAdmin = fakeAdmin as any;\n} else {\n  throw new Error(\n    \"Missing NEXT_PUBLIC_SUPABASE_URL or SUPABASE_SERVICE_ROLE_KEY in environment. Set APP_ALLOW_FAKE_SUPABASE=1 to enable a local fake client for tests.\"\n  );\n}\n\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 211, "column": 0}, "map": {"version":3,"sources":["file:///Users/pietromontanti/Desktop/approved-clean/Approved/lib/actorResolver.ts"],"sourcesContent":["import { supabaseAdmin } from './supabaseAdmin';\n\n// Resolve a possible actor identifier (could be UID or email) to a Supabase UID.\nexport async function resolveActorId(candidate: string | null): Promise<string | null> {\n  if (!candidate) return null;\n\n  // If the candidate is an Authorization header value like \"Bearer <token>\",\n  // try to resolve the token to a user via the admin client.\n  const maybeBearer = String(candidate || '').trim();\n  if (/^Bearer\\s+/i.test(maybeBearer)) {\n    const token = maybeBearer.split(/\\s+/)[1];\n    if (token) {\n      try {\n        const { data, error } = await supabaseAdmin.auth.getUser(token as string);\n        if (!error && data?.user?.id) return data.user.id;\n      } catch (e) {\n        // ignore\n      }\n    }\n  }\n\n  // If it already looks like a UUID, assume it's a UID\n  const uuidRegex = /^[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[1-5][0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12}$/;\n  if (uuidRegex.test(candidate)) return candidate;\n\n  // If it looks like an email, try to find the user by email using admin API\n  if (candidate.includes('@')) {\n    try {\n      // Prefer admin.listUsers if available\n      if (supabaseAdmin.auth && supabaseAdmin.auth.admin && typeof supabaseAdmin.auth.admin.listUsers === 'function') {\n        const res = await supabaseAdmin.auth.admin.listUsers({ search: candidate });\n        if (!res.error && res.data && Array.isArray(res.data.users)) {\n          const exact = res.data.users.find((u: any) => (u.email || '').toLowerCase() === candidate.toLowerCase());\n          if (exact) return exact.id;\n        }\n      }\n\n      // Fallback: query auth.users directly\n      try {\n        const { data } = await supabaseAdmin.from('auth.users').select('id,email').eq('email', candidate).limit(1).maybeSingle();\n        if (data && data.id) return data.id;\n      } catch (e) {\n        // ignore\n      }\n    } catch (e) {\n      // ignore lookup errors\n    }\n  }\n\n  return null;\n}\n\n"],"names":[],"mappings":";;;;AAAA;;AAGO,eAAe,eAAe,SAAwB;IAC3D,IAAI,CAAC,WAAW,OAAO;IAEvB,2EAA2E;IAC3E,2DAA2D;IAC3D,MAAM,cAAc,OAAO,aAAa,IAAI,IAAI;IAChD,IAAI,cAAc,IAAI,CAAC,cAAc;QACnC,MAAM,QAAQ,YAAY,KAAK,CAAC,MAAM,CAAC,EAAE;QACzC,IAAI,OAAO;YACT,IAAI;gBACF,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,GAAG,MAAM,uIAAa,CAAC,IAAI,CAAC,OAAO,CAAC;gBACzD,IAAI,CAAC,SAAS,MAAM,MAAM,IAAI,OAAO,KAAK,IAAI,CAAC,EAAE;YACnD,EAAE,OAAO,GAAG;YACV,SAAS;YACX;QACF;IACF;IAEA,qDAAqD;IACrD,MAAM,YAAY;IAClB,IAAI,UAAU,IAAI,CAAC,YAAY,OAAO;IAEtC,2EAA2E;IAC3E,IAAI,UAAU,QAAQ,CAAC,MAAM;QAC3B,IAAI;YACF,sCAAsC;YACtC,IAAI,uIAAa,CAAC,IAAI,IAAI,uIAAa,CAAC,IAAI,CAAC,KAAK,IAAI,OAAO,uIAAa,CAAC,IAAI,CAAC,KAAK,CAAC,SAAS,KAAK,YAAY;gBAC9G,MAAM,MAAM,MAAM,uIAAa,CAAC,IAAI,CAAC,KAAK,CAAC,SAAS,CAAC;oBAAE,QAAQ;gBAAU;gBACzE,IAAI,CAAC,IAAI,KAAK,IAAI,IAAI,IAAI,IAAI,MAAM,OAAO,CAAC,IAAI,IAAI,CAAC,KAAK,GAAG;oBAC3D,MAAM,QAAQ,IAAI,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,CAAC,IAAW,CAAC,EAAE,KAAK,IAAI,EAAE,EAAE,WAAW,OAAO,UAAU,WAAW;oBACrG,IAAI,OAAO,OAAO,MAAM,EAAE;gBAC5B;YACF;YAEA,sCAAsC;YACtC,IAAI;gBACF,MAAM,EAAE,IAAI,EAAE,GAAG,MAAM,uIAAa,CAAC,IAAI,CAAC,cAAc,MAAM,CAAC,YAAY,EAAE,CAAC,SAAS,WAAW,KAAK,CAAC,GAAG,WAAW;gBACtH,IAAI,QAAQ,KAAK,EAAE,EAAE,OAAO,KAAK,EAAE;YACrC,EAAE,OAAO,GAAG;YACV,SAAS;YACX;QACF,EAAE,OAAO,GAAG;QACV,uBAAuB;QACzB;IACF;IAEA,OAAO;AACT"}},
    {"offset": {"line": 266, "column": 0}, "map": {"version":3,"sources":["file:///Users/pietromontanti/Desktop/approved-clean/Approved/app/api/projects/route.ts"],"sourcesContent":["// app/api/projects/route.ts\nimport { NextResponse } from \"next/server\";\nimport { supabaseAdmin } from \"@/lib/supabaseAdmin\";\nimport { resolveActorId } from '@/lib/actorResolver';\n\ntype DbProject = {\n  id: string;\n  name: string;\n  description: string | null;\n  created_at: string;\n};\n\n/**\n * GET /api/projects\n * Ritorna la lista dei progetti da Supabase\n * Usa il service role per bypassare RLS\n */\nexport async function GET(req: Request) {\n  try {\n    console.log('[GET /api/projects] Request started');\n\n    // Quick debug: log incoming host and auth headers (no secrets printed)\n    const url = new URL(req.url);\n    const isDebug = url.searchParams.get('debug') === '1' || req.headers.get('x-debug') === '1';\n    console.log('[GET /api/projects] Fetching projects from Supabase... host=', url.host, 'debug=', isDebug);\n    if (isDebug) {\n      console.log('[GET /api/projects] Incoming headers (x-actor-id, authorization present):', {\n        'x-actor-id': Boolean(req.headers.get('x-actor-id')),\n        'authorization_present': Boolean(req.headers.get('authorization'))\n      });\n    }\n    \n    // If caller provides an actor id (x-actor-id) return two lists: my_projects and shared_with_me\n    let actorId = req.headers.get('x-actor-id');\n    // If header contains an email or non-UUID, try to resolve it to a UID\n    if (actorId) {\n      const resolved = await resolveActorId(actorId);\n      if (resolved) actorId = resolved;\n    }\n\n    // If no explicit actor id, try Authorization Bearer token\n    if (!actorId) {\n      const authHeader = req.headers.get('authorization') || '';\n      if (authHeader.toLowerCase().startsWith('bearer ')) {\n        const token = authHeader.split(' ')[1];\n        try {\n          const { data: verified, error: verifyErr } = await supabaseAdmin.auth.getUser(token as string);\n          if (!verifyErr && verified?.user?.id) actorId = verified.user.id;\n          else console.warn('[GET /api/projects] auth.getUser failed', verifyErr?.message || verifyErr);\n        } catch (e) {\n          console.warn('[GET /api/projects] token verification error', e?.message || e);\n        }\n      }\n    }\n\n    // If still no actorId, try to extract an access token from cookies (common cookie names)\n    if (!actorId) {\n      try {\n        const cookieHeader = req.headers.get('cookie') || '';\n        if (cookieHeader) {\n          // Common Supabase cookie names and patterns\n          const keys = ['sb-access-token', 'supabase-auth-token', 'access_token', 'token', 'sb:token'];\n          const pairs = cookieHeader.split(';').map(s => s.trim());\n          for (const pair of pairs) {\n            const eq = pair.indexOf('=');\n            if (eq === -1) continue;\n            const k = pair.substring(0, eq).trim();\n            const v = pair.substring(eq + 1).trim();\n            if (keys.includes(k) && v) {\n              // cookie may be URL encoded or JSON; try to parse JSON\n              let cand = v;\n              try {\n                cand = decodeURIComponent(v);\n              } catch (e) {}\n              if (cand.startsWith('{')) {\n                try {\n                  const parsed = JSON.parse(cand);\n                  // supabase session shapes may contain access_token\n                  if (parsed?.access_token) {\n                    const { data: verified, error: verifyErr } = await supabaseAdmin.auth.getUser(parsed.access_token);\n                    if (!verifyErr && verified?.user?.id) { actorId = verified.user.id; break; }\n                  }\n                } catch (e) {}\n              } else {\n                // try token-like string\n                const jwtMatch = cand.match(/([A-Za-z0-9-_]+\\.[A-Za-z0-9-_]+\\.[A-Za-z0-9-_]+)/);\n                const token = jwtMatch ? jwtMatch[1] : cand;\n                try {\n                  const { data: verified, error: verifyErr } = await supabaseAdmin.auth.getUser(token as string);\n                  if (!verifyErr && verified?.user?.id) { actorId = verified.user.id; break; }\n                } catch (e) {}\n              }\n            }\n          }\n        }\n      } catch (e) {\n        // ignore cookie parsing issues\n      }\n    }\n\n    if (!actorId) {\n      console.log('[GET /api/projects] No actor header or valid token provided — returning public projects list');\n    } else {\n      console.log('[GET /api/projects] Resolved actorId=', actorId);\n    }\n\n    if (actorId) {\n      // My projects: where owner_id == actorId\n      const { data: myProjects, error: myErr } = await supabaseAdmin\n        .from('projects')\n        .select('*')\n        .eq('owner_id', actorId)\n        .order('created_at', { ascending: false });\n\n      if (myErr) {\n        console.error('[GET /api/projects] Error loading my projects:', myErr);\n        return NextResponse.json({ error: myErr.message }, { status: 500 });\n      }\n\n      // Shared: projects where user is in project_members OR is member of a team that owns the project,\n      // excluding projects the user already owns\n      // 1) project_members\n      const { data: pmRows, error: pmErr } = await supabaseAdmin\n        .from('project_members')\n        .select('project_id, role')\n        .eq('member_id', actorId);\n\n      if (pmErr) {\n        console.error('[GET /api/projects] Error loading project_members:', pmErr);\n        return NextResponse.json({ error: pmErr.message }, { status: 500 });\n      }\n\n      const projectIdsFromMembers = (pmRows || []).map((r: any) => r.project_id).filter(Boolean);\n\n      // 2) team_members -> collect team ids\n      const { data: tmRows, error: tmErr } = await supabaseAdmin\n        .from('team_members')\n        .select('team_id')\n        .eq('user_id', actorId);\n\n      if (tmErr) {\n        console.error('[GET /api/projects] Error loading team_members:', tmErr);\n        return NextResponse.json({ error: tmErr.message }, { status: 500 });\n      }\n\n      const teamIds = (tmRows || []).map((t: any) => t.team_id).filter(Boolean);\n\n      // Collect shared project ids from team membership\n      let projectIdsFromTeams: string[] = [];\n      if (teamIds.length) {\n        const { data: projectsFromTeams, error: pftErr } = await supabaseAdmin\n          .from('projects')\n          .select('id')\n          .in('team_id', teamIds);\n\n        if (pftErr) {\n          console.error('[GET /api/projects] Error loading projects for teams:', pftErr);\n          return NextResponse.json({ error: pftErr.message }, { status: 500 });\n        }\n\n        projectIdsFromTeams = (projectsFromTeams || []).map((p: any) => p.id).filter(Boolean);\n      }\n\n      const sharedIdsSet = new Set<string>([...projectIdsFromMembers, ...projectIdsFromTeams]);\n      // Remove projects owned by actor\n      const ownedIds = new Set((myProjects || []).map((p: any) => p.id));\n      const finalSharedIds = Array.from(sharedIdsSet).filter((id) => !ownedIds.has(id));\n\n      let sharedProjects: any[] = [];\n      if (finalSharedIds.length) {\n        const { data: sp, error: spErr } = await supabaseAdmin\n          .from('projects')\n          .select('*')\n          .in('id', finalSharedIds)\n          .order('created_at', { ascending: false });\n\n        if (spErr) {\n          console.error('[GET /api/projects] Error loading shared projects:', spErr);\n          return NextResponse.json({ error: spErr.message }, { status: 500 });\n        }\n\n        sharedProjects = sp || [];\n      }\n\n      // For each project include team_members minimal info\n      const hydrate = async (projectsList: any[]) => {\n        return Promise.all(\n          (projectsList || []).map(async (project) => {\n            let teamMembersData: any[] = [];\n            try {\n              if (project.team_id) {\n                const { data } = await supabaseAdmin\n                  .from('team_members')\n                  .select('user_id, role, joined_at')\n                  .eq('team_id', project.team_id);\n                teamMembersData = data || [];\n              }\n            } catch (e: any) {\n              console.warn('[GET /api/projects] Warning loading team_members for project', project.id, e?.message || e);\n            }\n            return { ...project, team_members: teamMembersData };\n          })\n        );\n      };\n\n      const myProjectsHydrated = await hydrate(myProjects || []);\n      const sharedHydrated = await hydrate(sharedProjects || []);\n\n      // Maintain backward compatibility: include a combined `projects` array\n      const combined = [...(myProjectsHydrated || []), ...(sharedHydrated || [])];\n\n      const body = { my_projects: myProjectsHydrated, shared_with_me: sharedHydrated, projects: combined };\n      if (isDebug) body['__debug'] = { resolved_actor_id: actorId };\n      return NextResponse.json(body, { status: 200 });\n    }\n\n    // Fallback: return all projects (existing behavior)\n    const { data: projectsData, error: projectsError } = await supabaseAdmin\n      .from('projects')\n      .select('*')\n      .order('created_at', { ascending: false });\n\n    if (projectsError) {\n      console.error('[GET /api/projects] Error loading projects:', projectsError);\n      return NextResponse.json({ error: projectsError.message, code: projectsError.code }, { status: 500 });\n    }\n\n    const projects = await Promise.all(\n          (projectsData || []).map(async (project: any) => {\n        let teamMembersData: any[] = [];\n        try {\n          if (project.team_id) {\n            const { data } = await supabaseAdmin\n              .from('team_members')\n              .select('user_id, role, joined_at')\n              .eq('team_id', project.team_id);\n            teamMembersData = data || [];\n          }\n        } catch (e: any) {\n          console.warn('[GET /api/projects] Warning loading team_members for project', project.id, e?.message || e);\n        }\n\n        return { ...project, team_members: teamMembersData };\n      })\n    );\n\n    const respBody: any = { projects };\n    if (isDebug) respBody['__debug'] = { resolved_actor_id: null };\n    return NextResponse.json(respBody, { status: 200, headers: { 'Content-Type': 'application/json' } });\n  } catch (err: any) {\n    console.error(\"[GET /api/projects] Exception:\", {\n      message: err?.message,\n      stack: err?.stack\n    });\n    return NextResponse.json(\n      {\n        error: err?.message || \"Errore imprevisto\",\n        details: String(err),\n      },\n      { status: 500 }\n    );\n  }\n}\n\n/**\n * POST /api/projects\n * Crea un nuovo progetto su Supabase\n * Body JSON: { title: string, description?: string, team_id: string }\n */\nexport async function POST(req: Request) {\n  try {\n    const rawBody = await req.text();\n\n    if (!rawBody) {\n      console.error(\"[POST /api/projects] Empty request body\");\n      return NextResponse.json(\n        { error: \"Empty request body\" },\n        { status: 400 }\n      );\n    }\n\n    let body: any;\n    try {\n      body = JSON.parse(rawBody);\n    } catch (err) {\n      console.error(\n        \"[POST /api/projects] JSON parse error\",\n        err,\n        \"RAW:\",\n        rawBody\n      );\n      return NextResponse.json(\n        { error: \"Invalid JSON body\" },\n        { status: 400 }\n      );\n    }\n\n    const rawName = typeof body.name === \"string\" ? body.name : \"\";\n    const rawDescription =\n      typeof body.description === \"string\" ? body.description : \"\";\n    let teamId = typeof body.team_id === \"string\" ? body.team_id : \"\";\n\n    const name = rawName.trim();\n    const description = rawDescription.trim();\n\n    if (!name) {\n      return NextResponse.json(\n        { error: \"Name is required\" },\n        { status: 400 }\n      );\n    }\n\n    // Determine actor (owner) from Authorization or x-actor-id header\n    let actorId = req.headers.get('x-actor-id') || null;\n    try {\n      const authHeader = req.headers.get('authorization') || '';\n      if (authHeader.toLowerCase().startsWith('bearer ')) {\n        const token = authHeader.split(' ')[1];\n        if (token) {\n          const { data: verified, error: verifyErr } = await supabaseAdmin.auth.getUser(token);\n          if (!verifyErr && verified?.user?.id) actorId = verified.user.id;\n          else console.warn('[/api/projects] auth.getUser failed', verifyErr);\n        }\n      }\n    } catch (e) {\n      console.warn('[/api/projects] token verification error', e);\n    }\n\n    // If team_id is 'auto' or missing, get first team from DB or create one\n    if (!teamId || teamId === 'auto') {\n      console.log('[POST /api/projects] Auto-creating workspace');\n      \n      // Try to find existing team\n      const { data: existingTeams } = await supabaseAdmin\n        .from('teams')\n        .select('id')\n        .limit(1);\n      \n      if (existingTeams && existingTeams.length > 0) {\n        teamId = existingTeams[0].id;\n        console.log('[POST /api/projects] Using existing team:', teamId);\n      } else {\n        // Create new team\n        const { data: newTeam, error: teamError } = await supabaseAdmin\n          .from('teams')\n          .insert({ name: 'Personal Workspace', owner_id: actorId || 'system' })\n          .select()\n          .single();\n        \n        if (teamError) {\n          console.error('[POST /api/projects] Error creating team:', teamError);\n          return NextResponse.json(\n            { error: 'Failed to create workspace' },\n            { status: 500 }\n          );\n        }\n        \n        teamId = newTeam.id;\n        console.log('[POST /api/projects] Created new team:', teamId);\n      }\n    }\n\n    // Include owner_id if we determined an actor\n    const projectInsert: any = { name, description: description || null, team_id: teamId };\n    if (actorId) projectInsert.owner_id = actorId;\n\n    const { data, error } = await supabaseAdmin\n      .from(\"projects\")\n      .insert(projectInsert)\n      .select(\"id, name, description, created_at, team_id, owner_id\")\n      .single();\n\n    if (error) {\n      console.error(\"[POST /api/projects] Supabase insert error\", error);\n      return NextResponse.json(\n        {\n          error:\n            error.message || \"Errore nella creazione del progetto su Supabase\",\n          details: error,\n        },\n        { status: 500 }\n      );\n    }\n\n    // If we created the project and we know the owner, add membership row\n    try {\n      if (actorId && data?.id) {\n        await supabaseAdmin.from('project_members').upsert({ project_id: data.id, member_id: actorId, role: 'owner', added_by: actorId }, { onConflict: '(project_id, member_id)' });\n      }\n    } catch (e) {\n      console.warn('[POST /api/projects] Warning adding project_members for owner', e);\n    }\n\n    return NextResponse.json({ project: data as DbProject }, { status: 201 });\n  } catch (err: any) {\n    console.error(\"[POST /api/projects] Unexpected error\", err);\n    return NextResponse.json(\n      {\n        error:\n          err?.message || \"Errore imprevisto nella creazione del progetto\",\n        details: String(err),\n      },\n      { status: 500 }\n    );\n  }\n}\n\n/**\n * PATCH /api/projects\n * Aggiorna titolo e descrizione\n * Body JSON: { id: string, title?: string, description?: string }\n */\nexport async function PATCH(req: Request) {\n  try {\n    const rawBody = await req.text();\n\n    if (!rawBody) {\n      console.error(\"[PATCH /api/projects] Empty request body\");\n      return NextResponse.json(\n        { error: \"Empty request body\" },\n        { status: 400 }\n      );\n    }\n\n    let body: any;\n    try {\n      body = JSON.parse(rawBody);\n    } catch (err) {\n      console.error(\n        \"[PATCH /api/projects] JSON parse error\",\n        err,\n        \"RAW:\",\n        rawBody\n      );\n      return NextResponse.json(\n        { error: \"Invalid JSON body\" },\n        { status: 400 }\n      );\n    }\n\n    const id = typeof body.id === \"string\" ? body.id : \"\";\n    const rawName = typeof body.name === \"string\" ? body.name : \"\";\n    const rawDescription =\n      typeof body.description === \"string\" ? body.description : \"\";\n    const deleteCueId = typeof body.deleteCueId === \"string\" ? body.deleteCueId : \"\";\n\n    if (!id) {\n      return NextResponse.json(\n        { error: \"id is required\" },\n        { status: 400 }\n      );\n    }\n\n    // Handle cue deletion\n    if (deleteCueId) {\n      console.log(\"[PATCH /api/projects] Deleting cue:\", deleteCueId);\n      const { error: deleteError } = await supabaseAdmin\n        .from(\"cues\")\n        .delete()\n        .eq(\"id\", deleteCueId)\n        .eq(\"project_id\", id);\n\n      if (deleteError) {\n        console.error(\"[PATCH /api/projects] Supabase cue delete error\", deleteError);\n        return NextResponse.json(\n          {\n            error: deleteError.message || \"Errore nella cancellazione della cue\",\n            details: deleteError,\n          },\n          { status: 500 }\n        );\n      }\n\n      return NextResponse.json({ success: true, message: \"Cue deleted\" }, { status: 200 });\n    }\n\n    const update: { name?: string; description?: string | null } = {};\n\n    if (rawName.trim()) update.name = rawName.trim();\n    if (rawDescription.trim()) update.description = rawDescription.trim();\n\n    if (!Object.keys(update).length) {\n      return NextResponse.json(\n        { error: \"Nothing to update\" },\n        { status: 400 }\n      );\n    }\n\n    const { data, error } = await supabaseAdmin\n      .from(\"projects\")\n      .update(update)\n      .eq(\"id\", id)\n      .select(\"id, name, description, created_at\")\n      .single();\n\n    if (error) {\n      console.error(\"[PATCH /api/projects] Supabase update error\", error);\n      return NextResponse.json(\n        {\n          error: error.message || \"Errore nell'aggiornamento del progetto\",\n          details: error,\n        },\n        { status: 500 }\n      );\n    }\n\n    return NextResponse.json({ project: data as DbProject }, { status: 200 });\n  } catch (err: any) {\n    console.error(\"[PATCH /api/projects] Unexpected error\", err);\n    return NextResponse.json(\n      {\n        error:\n          err?.message || \"Errore imprevisto nell'aggiornamento del progetto\",\n        details: String(err),\n      },\n      { status: 500 }\n    );\n  }\n}\n\n/**\n * DELETE /api/projects\n * Cancella un progetto.\n * Può ricevere l'id sia nel body JSON { id } sia come query string ?id=...\n */\nexport async function DELETE(req: Request) {\n  try {\n    const url = new URL(req.url);\n    const queryId = url.searchParams.get(\"id\") ?? \"\";\n\n    const rawBody = await req.text();\n\n    let body: any = null;\n    if (rawBody) {\n      try {\n        body = JSON.parse(rawBody);\n      } catch (err) {\n        console.error(\n          \"[DELETE /api/projects] JSON parse error\",\n          err,\n          \"RAW:\",\n          rawBody\n        );\n        // Se il body è invalido ma abbiamo queryId, possiamo comunque procedere.\n      }\n    }\n\n    const bodyId =\n      body && typeof body.id === \"string\" ? body.id.trim() : \"\";\n\n    const id = bodyId || queryId;\n\n    if (!id) {\n      return NextResponse.json(\n        { error: \"id is required\" },\n        { status: 400 }\n      );\n    }\n\n    const { error } = await supabaseAdmin.from(\"projects\").delete().eq(\"id\", id);\n\n    if (error) {\n      console.error(\"[DELETE /api/projects] Supabase delete error\", error);\n      return NextResponse.json(\n        {\n          error:\n            error.message || \"Errore nella cancellazione del progetto\",\n          details: error,\n        },\n        { status: 500 }\n      );\n    }\n\n    return NextResponse.json({ success: true }, { status: 200 });\n  } catch (err: any) {\n    console.error(\"[DELETE /api/projects] Unexpected error\", err);\n    return NextResponse.json(\n      {\n        error:\n          err?.message ||\n          \"Errore imprevisto nella cancellazione del progetto\",\n        details: String(err),\n      },\n      { status: 500 }\n    );\n  }\n}\n"],"names":[],"mappings":"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"}}]
}