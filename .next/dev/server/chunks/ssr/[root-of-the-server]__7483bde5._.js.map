{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 10, "column": 0}, "map": {"version":3,"sources":["file:///Users/pietromontanti/Desktop/approved-clean/Approved/lib/supabaseClient.ts"],"sourcesContent":["// lib/supabaseClient.ts\nimport { createClient } from \"@supabase/supabase-js\";\n\nconst url = process.env.NEXT_PUBLIC_SUPABASE_URL;\nconst anon = process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY;\n\nif (!url || !anon) {\n  throw new Error(\n    \"[supabaseClient] Missing NEXT_PUBLIC_SUPABASE_URL or NEXT_PUBLIC_SUPABASE_ANON_KEY\"\n  );\n}\n\n// CRITICAL: This must work in browser AND server contexts\n// Server-side: just for type exports, won't actually use auth\n// Client-side: full auth with localStorage persistence\nlet supabaseInstance: any = null;\n\nexport function getSupabaseClient() {\n  // Only initialize on browser\n  if (typeof window === 'undefined') {\n    return createClient(url, anon);\n  }\n\n  if (!supabaseInstance) {\n    supabaseInstance = createClient(url, anon, {\n      auth: {\n        persistSession: true,\n        storageKey: 'approved-auth',\n        storage: window.localStorage,\n        autoRefreshToken: true,\n        detectSessionInUrl: true\n      }\n    });\n    console.log('[SupabaseClient] Initialized with persistence');\n    \n    // Make available globally\n    (window as any).supabaseClient = supabaseInstance;\n  }\n  \n  return supabaseInstance;\n}\n\n// Default export for backwards compatibility\nexport const supabase = getSupabaseClient();\n\n"],"names":[],"mappings":"AAAA,wBAAwB;;;;;;;AACxB;;AAEA,MAAM;AACN,MAAM;AAEN;;AAMA,0DAA0D;AAC1D,8DAA8D;AAC9D,uDAAuD;AACvD,IAAI,mBAAwB;AAErB,SAAS;IACd,6BAA6B;IAC7B,wCAAmC;QACjC,OAAO,IAAA,uLAAY,EAAC,KAAK;IAC3B;;;AAmBF;AAGO,MAAM,WAAW"}},
    {"offset": {"line": 40, "column": 0}, "map": {"version":3,"sources":["file:///Users/pietromontanti/Desktop/approved-clean/Approved/app/components/SupabaseSyncBridge.tsx"],"sourcesContent":["\"use client\";\n\nimport { useEffect } from \"react\";\nimport { supabase } from \"@/lib/supabaseClient\";\n\nexport default function SupabaseSyncBridge() {\n  useEffect(() => {\n    // Expose Supabase client and sync functions to global scope\n    window.supabase = supabase;\n\n    window.SupabaseSync = {\n      async saveProject(project: any) {\n        try {\n          const { error } = await supabase.from(\"projects\").upsert(\n            { id: project.id, name: project.name, description: project.description || null },\n            { onConflict: \"id\" }\n          );\n          if (error) throw error;\n          console.log(\"✅ Project saved:\", project.id);\n          return true;\n        } catch (err) {\n          console.error(\"❌ Error saving project:\", err);\n          return false;\n        }\n      },\n\n      async loadProjects() {\n        try {\n          const { data, error } = await supabase\n            .from(\"projects\")\n            .select(`id, name, description, created_at, updated_at, cues(id, project_id, index_in_project, original_name, name, display_name, status, versions(id, cue_id, index_in_cue, status, media_type, media_storage_path, media_url, media_original_name, media_display_name, media_duration, media_thumbnail_path, media_thumbnail_url, media_waveform_data))`)\n            .order(\"created_at\", { ascending: true });\n          if (error) throw error;\n          console.log(\"✅ Projects loaded:\", data?.length || 0);\n          return data || [];\n        } catch (err) {\n          console.error(\"❌ Error loading projects:\", err);\n          return [];\n        }\n      },\n\n      async saveCue(projectId: string, cue: any) {\n        try {\n          const { error } = await supabase.from(\"cues\").upsert(\n            {\n              id: cue.id,\n              project_id: projectId,\n              index_in_project: cue.index || cue.indexInProject || 0,\n              original_name: cue.originalName || null,\n              name: cue.name || null,\n              display_name: cue.displayName || null,\n              status: cue.status || \"in-review\",\n            },\n            { onConflict: \"id\" }\n          );\n          if (error) throw error;\n          console.log(\"✅ Cue saved:\", cue.id);\n          return true;\n        } catch (err) {\n          console.error(\"❌ Error saving cue:\", err);\n          return false;\n        }\n      },\n\n      async saveVersion(cueId: string, version: any) {\n        try {\n          const { error } = await supabase.from(\"versions\").upsert(\n            {\n              id: version.id,\n              cue_id: cueId,\n              index_in_cue: version.index || version.indexInCue || 0,\n              status: version.status || \"in-review\",\n              media_type: version.media?.type || null,\n              media_storage_path: version.media?.storagePath || null,\n              media_url: version.media?.url || null,\n              media_original_name: version.media?.originalName || null,\n              media_display_name: version.media?.displayName || null,\n              media_duration: version.media?.duration || null,\n              media_thumbnail_path: version.media?.thumbnailPath || null,\n              media_thumbnail_url: version.media?.thumbnailUrl || null,\n            },\n            { onConflict: \"id\" }\n          );\n          if (error) throw error;\n          console.log(\"✅ Version saved:\", version.id);\n          return true;\n        } catch (err) {\n          console.error(\"❌ Error saving version:\", err);\n          return false;\n        }\n      },\n\n      async saveVersionFile(versionId: string, file: any) {\n        try {\n          const { error } = await supabase.from(\"version_files\").upsert(\n            {\n              id: file.id,\n              version_id: versionId,\n              name: file.name,\n              type: file.type || null,\n              url: file.url || null,\n              size: file.size || null,\n            },\n            { onConflict: \"id\" }\n          );\n          if (error) throw error;\n          console.log(\"✅ Version file saved:\", file.id);\n          return true;\n        } catch (err) {\n          console.error(\"❌ Error saving version file:\", err);\n          return false;\n        }\n      },\n    };\n\n    console.log(\"✅ SupabaseSync bridge initialized\");\n\n    // Trigger initialization of flow.js if already loaded\n    if (window.dispatchEvent) {\n      window.dispatchEvent(new Event(\"supabase-sync-ready\"));\n    }\n  }, []);\n\n  return null;\n}\n"],"names":[],"mappings":"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"}}]
}