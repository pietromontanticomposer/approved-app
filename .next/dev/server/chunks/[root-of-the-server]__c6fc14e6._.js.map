{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 52, "column": 0}, "map": {"version":3,"sources":["file:///Users/pietromontanti/Desktop/approved-clean/Approved/app/api/projects/route.ts"],"sourcesContent":["// app/api/projects/route.ts\nimport { NextResponse } from \"next/server\";\nimport { supabaseAdmin } from \"@/lib/supabaseAdmin\";\n\ntype DbProject = {\n  id: string;\n  name: string;\n  description: string | null;\n  created_at: string;\n};\n\n/**\n * GET /api/projects\n * Ritorna la lista dei progetti da Supabase\n * Usa il service role per bypassare RLS\n */\nexport async function GET(req: Request) {\n  try {\n    console.log('[GET /api/projects] Request started');\n\n    console.log('[GET /api/projects] Fetching projects from Supabase...');\n    \n    // If caller provides an actor id (x-actor-id) return two lists: my_projects and shared_with_me\n    const actorId = req.headers.get('x-actor-id');\n\n    if (actorId) {\n      // My projects: where owner_id == actorId\n      const { data: myProjects, error: myErr } = await supabaseAdmin\n        .from('projects')\n        .select('*')\n        .eq('owner_id', actorId)\n        .order('created_at', { ascending: false });\n\n      if (myErr) {\n        console.error('[GET /api/projects] Error loading my projects:', myErr);\n        return NextResponse.json({ error: myErr.message }, { status: 500 });\n      }\n\n      // Shared: projects where user is in project_members OR is member of a team that owns the project,\n      // excluding projects the user already owns\n      // 1) project_members\n      const { data: pmRows, error: pmErr } = await supabaseAdmin\n        .from('project_members')\n        .select('project_id, role')\n        .eq('member_id', actorId);\n\n      if (pmErr) {\n        console.error('[GET /api/projects] Error loading project_members:', pmErr);\n        return NextResponse.json({ error: pmErr.message }, { status: 500 });\n      }\n\n      const projectIdsFromMembers = (pmRows || []).map((r: any) => r.project_id).filter(Boolean);\n\n      // 2) team_members -> collect team ids\n      const { data: tmRows, error: tmErr } = await supabaseAdmin\n        .from('team_members')\n        .select('team_id')\n        .eq('user_id', actorId);\n\n      if (tmErr) {\n        console.error('[GET /api/projects] Error loading team_members:', tmErr);\n        return NextResponse.json({ error: tmErr.message }, { status: 500 });\n      }\n\n      const teamIds = (tmRows || []).map((t: any) => t.team_id).filter(Boolean);\n\n      // Collect shared project ids from team membership\n      let projectIdsFromTeams: string[] = [];\n      if (teamIds.length) {\n        const { data: projectsFromTeams, error: pftErr } = await supabaseAdmin\n          .from('projects')\n          .select('id')\n          .in('team_id', teamIds);\n\n        if (pftErr) {\n          console.error('[GET /api/projects] Error loading projects for teams:', pftErr);\n          return NextResponse.json({ error: pftErr.message }, { status: 500 });\n        }\n\n        projectIdsFromTeams = (projectsFromTeams || []).map((p: any) => p.id).filter(Boolean);\n      }\n\n      const sharedIdsSet = new Set<string>([...projectIdsFromMembers, ...projectIdsFromTeams]);\n      // Remove projects owned by actor\n      const ownedIds = new Set((myProjects || []).map((p: any) => p.id));\n      const finalSharedIds = Array.from(sharedIdsSet).filter((id) => !ownedIds.has(id));\n\n      let sharedProjects: any[] = [];\n      if (finalSharedIds.length) {\n        const { data: sp, error: spErr } = await supabaseAdmin\n          .from('projects')\n          .select('*')\n          .in('id', finalSharedIds)\n          .order('created_at', { ascending: false });\n\n        if (spErr) {\n          console.error('[GET /api/projects] Error loading shared projects:', spErr);\n          return NextResponse.json({ error: spErr.message }, { status: 500 });\n        }\n\n        sharedProjects = sp || [];\n      }\n\n      // For each project include team_members minimal info\n      const hydrate = async (projectsList: any[]) => {\n        return Promise.all(\n          (projectsList || []).map(async (project) => {\n            let teamMembersData: any[] = [];\n            try {\n              if (project.team_id) {\n                const { data } = await supabaseAdmin\n                  .from('team_members')\n                  .select('user_id, role, joined_at')\n                  .eq('team_id', project.team_id);\n                teamMembersData = data || [];\n              }\n            } catch (e) {\n              console.warn('[GET /api/projects] Warning loading team_members for project', project.id, e?.message || e);\n            }\n            return { ...project, team_members: teamMembersData };\n          })\n        );\n      };\n\n      const myProjectsHydrated = await hydrate(myProjects || []);\n      const sharedHydrated = await hydrate(sharedProjects || []);\n\n      return NextResponse.json({ my_projects: myProjectsHydrated, shared_with_me: sharedHydrated }, { status: 200 });\n    }\n\n    // Fallback: return all projects (existing behavior)\n    const { data: projectsData, error: projectsError } = await supabaseAdmin\n      .from('projects')\n      .select('*')\n      .order('created_at', { ascending: false });\n\n    if (projectsError) {\n      console.error('[GET /api/projects] Error loading projects:', projectsError);\n      return NextResponse.json({ error: projectsError.message, code: projectsError.code }, { status: 500 });\n    }\n\n    const projects = await Promise.all(\n      (projectsData || []).map(async (project) => {\n        let teamMembersData: any[] = [];\n        try {\n          if (project.team_id) {\n            const { data } = await supabaseAdmin\n              .from('team_members')\n              .select('user_id, role, joined_at')\n              .eq('team_id', project.team_id);\n            teamMembersData = data || [];\n          }\n        } catch (e) {\n          console.warn('[GET /api/projects] Warning loading team_members for project', project.id, e?.message || e);\n        }\n\n        return { ...project, team_members: teamMembersData };\n      })\n    );\n\n    return NextResponse.json({ projects }, { status: 200, headers: { 'Content-Type': 'application/json' } });\n  } catch (err: any) {\n    console.error(\"[GET /api/projects] Exception:\", {\n      message: err?.message,\n      stack: err?.stack\n    });\n    return NextResponse.json(\n      {\n        error: err?.message || \"Errore imprevisto\",\n        details: String(err),\n      },\n      { status: 500 }\n    );\n  }\n}\n\n/**\n * POST /api/projects\n * Crea un nuovo progetto su Supabase\n * Body JSON: { title: string, description?: string, team_id: string }\n */\nexport async function POST(req: Request) {\n  try {\n    const rawBody = await req.text();\n\n    if (!rawBody) {\n      console.error(\"[POST /api/projects] Empty request body\");\n      return NextResponse.json(\n        { error: \"Empty request body\" },\n        { status: 400 }\n      );\n    }\n\n    let body: any;\n    try {\n      body = JSON.parse(rawBody);\n    } catch (err) {\n      console.error(\n        \"[POST /api/projects] JSON parse error\",\n        err,\n        \"RAW:\",\n        rawBody\n      );\n      return NextResponse.json(\n        { error: \"Invalid JSON body\" },\n        { status: 400 }\n      );\n    }\n\n    const rawName = typeof body.name === \"string\" ? body.name : \"\";\n    const rawDescription =\n      typeof body.description === \"string\" ? body.description : \"\";\n    let teamId = typeof body.team_id === \"string\" ? body.team_id : \"\";\n\n    const name = rawName.trim();\n    const description = rawDescription.trim();\n\n    if (!name) {\n      return NextResponse.json(\n        { error: \"Name is required\" },\n        { status: 400 }\n      );\n    }\n\n    // Determine actor (owner) from Authorization or x-actor-id header\n    let actorId = req.headers.get('x-actor-id') || null;\n    try {\n      const authHeader = req.headers.get('authorization') || '';\n      if (authHeader.toLowerCase().startsWith('bearer ')) {\n        const token = authHeader.split(' ')[1];\n        if (token) {\n          const { data: verified, error: verifyErr } = await supabaseAdmin.auth.getUser(token);\n          if (!verifyErr && verified?.user?.id) actorId = verified.user.id;\n          else console.warn('[/api/projects] auth.getUser failed', verifyErr);\n        }\n      }\n    } catch (e) {\n      console.warn('[/api/projects] token verification error', e);\n    }\n\n    // If team_id is 'auto' or missing, get first team from DB or create one\n    if (!teamId || teamId === 'auto') {\n      console.log('[POST /api/projects] Auto-creating workspace');\n      \n      // Try to find existing team\n      const { data: existingTeams } = await supabaseAdmin\n        .from('teams')\n        .select('id')\n        .limit(1);\n      \n      if (existingTeams && existingTeams.length > 0) {\n        teamId = existingTeams[0].id;\n        console.log('[POST /api/projects] Using existing team:', teamId);\n      } else {\n        // Create new team\n        const { data: newTeam, error: teamError } = await supabaseAdmin\n          .from('teams')\n          .insert({ name: 'Personal Workspace', owner_id: actorId || 'system' })\n          .select()\n          .single();\n        \n        if (teamError) {\n          console.error('[POST /api/projects] Error creating team:', teamError);\n          return NextResponse.json(\n            { error: 'Failed to create workspace' },\n            { status: 500 }\n          );\n        }\n        \n        teamId = newTeam.id;\n        console.log('[POST /api/projects] Created new team:', teamId);\n      }\n    }\n\n    // Include owner_id if we determined an actor\n    const projectInsert: any = { name, description: description || null, team_id: teamId };\n    if (actorId) projectInsert.owner_id = actorId;\n\n    const { data, error } = await supabaseAdmin\n      .from(\"projects\")\n      .insert(projectInsert)\n      .select(\"id, name, description, created_at, team_id, owner_id\")\n      .single();\n\n    if (error) {\n      console.error(\"[POST /api/projects] Supabase insert error\", error);\n      return NextResponse.json(\n        {\n          error:\n            error.message || \"Errore nella creazione del progetto su Supabase\",\n          details: error,\n        },\n        { status: 500 }\n      );\n    }\n\n    // If we created the project and we know the owner, add membership row\n    try {\n      if (actorId && data?.id) {\n        await supabaseAdmin.from('project_members').upsert({ project_id: data.id, member_id: actorId, role: 'owner', added_by: actorId }, { onConflict: '(project_id, member_id)' });\n      }\n    } catch (e) {\n      console.warn('[POST /api/projects] Warning adding project_members for owner', e);\n    }\n\n    return NextResponse.json({ project: data as DbProject }, { status: 201 });\n  } catch (err: any) {\n    console.error(\"[POST /api/projects] Unexpected error\", err);\n    return NextResponse.json(\n      {\n        error:\n          err?.message || \"Errore imprevisto nella creazione del progetto\",\n        details: String(err),\n      },\n      { status: 500 }\n    );\n  }\n}\n\n/**\n * PATCH /api/projects\n * Aggiorna titolo e descrizione\n * Body JSON: { id: string, title?: string, description?: string }\n */\nexport async function PATCH(req: Request) {\n  try {\n    const rawBody = await req.text();\n\n    if (!rawBody) {\n      console.error(\"[PATCH /api/projects] Empty request body\");\n      return NextResponse.json(\n        { error: \"Empty request body\" },\n        { status: 400 }\n      );\n    }\n\n    let body: any;\n    try {\n      body = JSON.parse(rawBody);\n    } catch (err) {\n      console.error(\n        \"[PATCH /api/projects] JSON parse error\",\n        err,\n        \"RAW:\",\n        rawBody\n      );\n      return NextResponse.json(\n        { error: \"Invalid JSON body\" },\n        { status: 400 }\n      );\n    }\n\n    const id = typeof body.id === \"string\" ? body.id : \"\";\n    const rawName = typeof body.name === \"string\" ? body.name : \"\";\n    const rawDescription =\n      typeof body.description === \"string\" ? body.description : \"\";\n    const deleteCueId = typeof body.deleteCueId === \"string\" ? body.deleteCueId : \"\";\n\n    if (!id) {\n      return NextResponse.json(\n        { error: \"id is required\" },\n        { status: 400 }\n      );\n    }\n\n    // Handle cue deletion\n    if (deleteCueId) {\n      console.log(\"[PATCH /api/projects] Deleting cue:\", deleteCueId);\n      const { error: deleteError } = await supabaseAdmin\n        .from(\"cues\")\n        .delete()\n        .eq(\"id\", deleteCueId)\n        .eq(\"project_id\", id);\n\n      if (deleteError) {\n        console.error(\"[PATCH /api/projects] Supabase cue delete error\", deleteError);\n        return NextResponse.json(\n          {\n            error: deleteError.message || \"Errore nella cancellazione della cue\",\n            details: deleteError,\n          },\n          { status: 500 }\n        );\n      }\n\n      return NextResponse.json({ success: true, message: \"Cue deleted\" }, { status: 200 });\n    }\n\n    const update: { name?: string; description?: string | null } = {};\n\n    if (rawName.trim()) update.name = rawName.trim();\n    if (rawDescription.trim()) update.description = rawDescription.trim();\n\n    if (!Object.keys(update).length) {\n      return NextResponse.json(\n        { error: \"Nothing to update\" },\n        { status: 400 }\n      );\n    }\n\n    const { data, error } = await supabaseAdmin\n      .from(\"projects\")\n      .update(update)\n      .eq(\"id\", id)\n      .select(\"id, name, description, created_at\")\n      .single();\n\n    if (error) {\n      console.error(\"[PATCH /api/projects] Supabase update error\", error);\n      return NextResponse.json(\n        {\n          error: error.message || \"Errore nell'aggiornamento del progetto\",\n          details: error,\n        },\n        { status: 500 }\n      );\n    }\n\n    return NextResponse.json({ project: data as DbProject }, { status: 200 });\n  } catch (err: any) {\n    console.error(\"[PATCH /api/projects] Unexpected error\", err);\n    return NextResponse.json(\n      {\n        error:\n          err?.message || \"Errore imprevisto nell'aggiornamento del progetto\",\n        details: String(err),\n      },\n      { status: 500 }\n    );\n  }\n}\n\n/**\n * DELETE /api/projects\n * Cancella un progetto.\n * Può ricevere l'id sia nel body JSON { id } sia come query string ?id=...\n */\nexport async function DELETE(req: Request) {\n  try {\n    const url = new URL(req.url);\n    const queryId = url.searchParams.get(\"id\") ?? \"\";\n\n    const rawBody = await req.text();\n\n    let body: any = null;\n    if (rawBody) {\n      try {\n        body = JSON.parse(rawBody);\n      } catch (err) {\n        console.error(\n          \"[DELETE /api/projects] JSON parse error\",\n          err,\n          \"RAW:\",\n          rawBody\n        );\n        // Se il body è invalido ma abbiamo queryId, possiamo comunque procedere.\n      }\n    }\n\n    const bodyId =\n      body && typeof body.id === \"string\" ? body.id.trim() : \"\";\n\n    const id = bodyId || queryId;\n\n    if (!id) {\n      return NextResponse.json(\n        { error: \"id is required\" },\n        { status: 400 }\n      );\n    }\n\n    const { error } = await supabaseAdmin.from(\"projects\").delete().eq(\"id\", id);\n\n    if (error) {\n      console.error(\"[DELETE /api/projects] Supabase delete error\", error);\n      return NextResponse.json(\n        {\n          error:\n            error.message || \"Errore nella cancellazione del progetto\",\n          details: error,\n        },\n        { status: 500 }\n      );\n    }\n\n    return NextResponse.json({ success: true }, { status: 200 });\n  } catch (err: any) {\n    console.error(\"[DELETE /api/projects] Unexpected error\", err);\n    return NextResponse.json(\n      {\n        error:\n          err?.message ||\n          \"Errore imprevisto nella cancellazione del progetto\",\n        details: String(err),\n      },\n      { status: 500 }\n    );\n  }\n}\n"],"names":[],"mappings":"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"}}]
}