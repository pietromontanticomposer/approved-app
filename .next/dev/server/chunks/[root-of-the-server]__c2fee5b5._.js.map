{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 52, "column": 0}, "map": {"version":3,"sources":["file:///Users/pietromontanti/Desktop/approved-clean/Approved/lib/supabaseAdmin.ts"],"sourcesContent":["import { createClient } from \"@supabase/supabase-js\";\n\nconst supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL;\nconst supabaseServiceKey = process.env.SUPABASE_SERVICE_ROLE_KEY;\n\n// Export a variable and assign it below to avoid `export` inside conditionals\nexport let supabaseAdmin: any = null;\n\n// If real env vars are present, use real client. Otherwise, if testing is enabled,\n// provide a lightweight in-memory fake client to allow local tests without secrets.\nif (supabaseUrl && supabaseServiceKey) {\n  // Admin client â€” use only on the server\n  supabaseAdmin = createClient(supabaseUrl, supabaseServiceKey, {\n    auth: { persistSession: false },\n  });\n} else if (process.env.APP_ALLOW_FAKE_SUPABASE === '1') {\n  // Simple in-memory fake DB with minimal API surface used by the server routes.\n  type Row = Record<string, any>;\n  const db: Record<string, Row[]> = {\n    projects: [\n      { id: 'p1', team_id: 't1', owner_id: 'owner-1', name: 'Test Project' },\n    ],\n    share_links: [],\n    project_members: [],\n    team_members: [ { team_id: 't1', user_id: 'owner-1', role: 'owner' } ],\n    audit_logs: [],\n  };\n\n  const { v4: uuidv4 } = require('uuid');\n  function clone(obj: any) { return JSON.parse(JSON.stringify(obj)); }\n\n  function createFrom(tableName: string) {\n    const q: any = {\n      _table: tableName,\n      _select: '*',\n      _where: [] as Array<{k:string,v:any}>,\n      _limit: null as number | null,\n      select(cols?: string) { q._select = cols || '*'; return q; },\n      eq(k: string, v: any) { q._where.push({k,v}); return q; },\n      limit(n: number) { q._limit = n; return q; },\n      maybeSingle: async () => {\n        const rows = db[tableName] || [];\n        const filtered = rows.filter(r => q._where.every(w => String(r[w.k]) === String(w.v)));\n        return { data: filtered.length>0 ? clone(filtered[0]) : null, error: null };\n      },\n      insert: (payload: any) => {\n        const rows = db[tableName] || (db[tableName] = []);\n        const toInsert = Array.isArray(payload) ? payload : [payload];\n        const inserted = toInsert.map((p: any) => {\n          const row = Object.assign({}, p);\n          if (!row.id) row.id = uuidv4();\n          row.created_at = new Date().toISOString();\n          rows.push(row);\n          return row;\n        });\n        return {\n          data: inserted,\n          error: null,\n          select: () => ({\n            single: async () => ({ data: inserted[0], error: null })\n          })\n        };\n      },\n      update: (payload: any) => {\n        // return chainable object supporting .eq(k,v)\n        return {\n          eq: async (k: string, v: any) => {\n            const rows = db[tableName] || [];\n            let updatedCount = 0;\n            for (const r of rows) {\n              if (q._where.every(w => String(r[w.k]) === String(w.v)) && String(r[k]) === String(v)) {\n                Object.assign(r, payload);\n                updatedCount++;\n              }\n            }\n            return { data: updatedCount>0 ? rows.filter(r => (q._where.every(w => String(r[w.k]) === String(w.v)) && String(r[k]) === String(v))) : [], error: null };\n          }\n        };\n      },\n      upsert: async (payload: any, opts?: any) => {\n        const rows = db[tableName] || (db[tableName] = []);\n        // naive onConflict by project_id,member_id\n        const existing = rows.find(r => r.project_id === payload.project_id && r.member_id === payload.member_id);\n        if (existing) {\n          Object.assign(existing, payload);\n          return { data: [existing], error: null };\n        }\n        const row = Object.assign({}, payload);\n        if (!row.id) row.id = uuidv4();\n        rows.push(row);\n        return { data: [row], error: null };\n      },\n      single: async () => {\n        const rows = db[tableName] || [];\n        const filtered = rows.filter(r => q._where.every(w => String(r[w.k]) === String(w.v)));\n        return { data: filtered[0] || null, error: null };\n      }\n    };\n    return q;\n  }\n\n  const fakeAdmin = {\n    from: (table: string) => createFrom(table),\n  };\n\n  supabaseAdmin = fakeAdmin as any;\n} else {\n  throw new Error(\n    \"Missing NEXT_PUBLIC_SUPABASE_URL or SUPABASE_SERVICE_ROLE_KEY in environment. Set APP_ALLOW_FAKE_SUPABASE=1 to enable a local fake client for tests.\"\n  );\n}\n\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 211, "column": 0}, "map": {"version":3,"sources":["file:///Users/pietromontanti/Desktop/approved-clean/Approved/lib/supabaseClient.ts"],"sourcesContent":["// lib/supabaseClient.ts\nimport { createClient } from \"@supabase/supabase-js\";\n\nconst url = process.env.NEXT_PUBLIC_SUPABASE_URL;\nconst anon = process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY;\n\nif (!url || !anon) {\n  throw new Error(\n    \"[supabaseClient] Missing NEXT_PUBLIC_SUPABASE_URL or NEXT_PUBLIC_SUPABASE_ANON_KEY\"\n  );\n}\n\n// CRITICAL: This must work in browser AND server contexts\n// Server-side: just for type exports, won't actually use auth\n// Client-side: full auth with localStorage persistence\nlet supabaseInstance: any = null;\n\nexport function getSupabaseClient() {\n  // Only initialize on browser\n  if (typeof window === 'undefined') {\n    return createClient(url, anon);\n  }\n\n  if (!supabaseInstance) {\n    supabaseInstance = createClient(url, anon, {\n      auth: {\n        persistSession: true,\n        storageKey: 'approved-auth',\n        storage: window.localStorage,\n        autoRefreshToken: true,\n        detectSessionInUrl: true\n      }\n    });\n    console.log('[SupabaseClient] Initialized with persistence');\n    \n    // Make available globally\n    (window as any).supabaseClient = supabaseInstance;\n  }\n  \n  return supabaseInstance;\n}\n\n// Default export for backwards compatibility\nexport const supabase = getSupabaseClient();\n\n"],"names":[],"mappings":"AAAA,wBAAwB;;;;;;;AACxB;;AAEA,MAAM;AACN,MAAM;AAEN;;AAMA,0DAA0D;AAC1D,8DAA8D;AAC9D,uDAAuD;AACvD,IAAI,mBAAwB;AAErB,SAAS;IACd,6BAA6B;IAC7B,wCAAmC;QACjC,OAAO,IAAA,yLAAY,EAAC,KAAK;IAC3B;;;AAmBF;AAGO,MAAM,WAAW"}},
    {"offset": {"line": 241, "column": 0}, "map": {"version":3,"sources":["file:///Users/pietromontanti/Desktop/approved-clean/Approved/lib/auth.ts"],"sourcesContent":["// lib/auth.ts\nimport { supabase } from \"./supabaseClient\";\nimport { supabaseAdmin } from \"./supabaseAdmin\";\nimport { NextRequest } from 'next/server';\n\n// =======================\n// CLIENT-SIDE AUTH\n// =======================\n\n/**\n * Ottiene l'utente autenticato corrente (CLIENT-SIDE)\n */\nexport async function getCurrentUser() {\n  const { data: { user }, error } = await supabase.auth.getUser();\n\n  if (error || !user) {\n    return null;\n  }\n\n  return user;\n}\n\n// =======================\n// SERVER-SIDE AUTH\n// =======================\n\nexport interface AuthContext {\n  userId: string;\n  email: string;\n  isAuthenticated: boolean;\n}\n\n/**\n * Verify authentication from request headers (SERVER-SIDE)\n * CRITICAL: This function MUST be used on all protected API routes\n *\n * Verification flow:\n * 1. Extract Bearer token from Authorization header\n * 2. Verify token with Supabase auth\n * 3. Return authenticated user ID\n *\n * DO NOT trust x-actor-id header - it can be spoofed by clients\n */\nexport async function verifyAuth(req: NextRequest): Promise<AuthContext | null> {\n  try {\n    // Extract Bearer token from Authorization header\n    const authHeader = req.headers.get('authorization');\n    if (!authHeader || !authHeader.startsWith('Bearer ')) {\n      console.log('[Auth] No valid authorization header found');\n      return null;\n    }\n\n    const token = authHeader.substring(7); // Remove \"Bearer \" prefix\n    if (!token) {\n      console.log('[Auth] Empty token');\n      return null;\n    }\n\n    // Verify token with Supabase\n    const { data, error } = await supabaseAdmin.auth.getUser(token);\n\n    if (error || !data.user) {\n      console.log('[Auth] Token verification failed:', error?.message);\n      return null;\n    }\n\n    return {\n      userId: data.user.id,\n      email: data.user.email || '',\n      isAuthenticated: true,\n    };\n  } catch (err) {\n    console.error('[Auth] Unexpected error during auth verification:', err);\n    return null;\n  }\n}\n\n/**\n * Get authenticated user ID or throw 401 error (SERVER-SIDE)\n * Use this in API routes that REQUIRE authentication\n */\nexport async function requireAuth(req: NextRequest): Promise<string> {\n  const auth = await verifyAuth(req);\n  if (!auth) {\n    throw new Error('UNAUTHORIZED');\n  }\n  return auth.userId;\n}\n\n/**\n * Check if user has permission to access a project (SERVER-SIDE)\n * Returns true if user is owner or team member\n */\nexport async function canAccessProject(userId: string, projectId: string): Promise<boolean> {\n  try {\n    // Check if user owns the project\n    const { data: project, error: projectError } = await supabaseAdmin\n      .from('projects')\n      .select('owner_id, team_id')\n      .eq('id', projectId)\n      .single();\n\n    if (projectError || !project) {\n      return false;\n    }\n\n    // User is owner\n    if (project.owner_id === userId) {\n      return true;\n    }\n\n    // Check if user is in project_members\n    const { data: member } = await supabaseAdmin\n      .from('project_members')\n      .select('id')\n      .eq('project_id', projectId)\n      .eq('member_id', userId)\n      .maybeSingle();\n\n    if (member) {\n      return true;\n    }\n\n    // Check if user is in team\n    if (project.team_id) {\n      const { data: teamMember } = await supabaseAdmin\n        .from('team_members')\n        .select('id')\n        .eq('team_id', project.team_id)\n        .eq('user_id', userId)\n        .maybeSingle();\n\n      if (teamMember) {\n        return true;\n      }\n    }\n\n    return false;\n  } catch (err) {\n    console.error('[Auth] Error checking project access:', err);\n    return false;\n  }\n}\n\n/**\n * Check if user can modify a project (owner or admin) (SERVER-SIDE)\n */\nexport async function canModifyProject(userId: string, projectId: string): Promise<boolean> {\n  try {\n    const { data: project } = await supabaseAdmin\n      .from('projects')\n      .select('owner_id, team_id')\n      .eq('id', projectId)\n      .single();\n\n    if (!project) {\n      return false;\n    }\n\n    // Only owner can modify\n    if (project.owner_id === userId) {\n      return true;\n    }\n\n    // Check if user is admin in team\n    if (project.team_id) {\n      const { data: teamMember } = await supabaseAdmin\n        .from('team_members')\n        .select('role')\n        .eq('team_id', project.team_id)\n        .eq('user_id', userId)\n        .maybeSingle();\n\n      if (teamMember && teamMember.role === 'admin') {\n        return true;\n      }\n    }\n\n    return false;\n  } catch (err) {\n    console.error('[Auth] Error checking modify permission:', err);\n    return false;\n  }\n}\n\n/**\n * Ottiene il primo team dell'utente (tipicamente il workspace personale)\n */\nexport async function getUserDefaultTeam(userId: string) {\n  const { data, error } = await supabase\n    .from(\"team_members\")\n    .select(\"team_id, role, teams(id, name)\")\n    .eq(\"user_id\", userId)\n    .order(\"joined_at\", { ascending: true })\n    .limit(1)\n    .single();\n\n  if (error || !data) {\n    return null;\n  }\n\n  return {\n    teamId: data.team_id,\n    role: data.role,\n    teamName: (data.teams as any)?.name || \"My Workspace\",\n  };\n}\n\n/**\n * Ottiene tutti i team dell'utente\n */\nexport async function getUserTeams(userId: string) {\n  const { data, error } = await supabase\n    .from(\"team_members\")\n    .select(\"team_id, role, joined_at, teams(id, name, description)\")\n    .eq(\"user_id\", userId)\n    .order(\"joined_at\", { ascending: true });\n\n  if (error || !data) {\n    return [];\n  }\n\n  return data.map((tm) => ({\n    teamId: tm.team_id,\n    role: tm.role,\n    joinedAt: tm.joined_at,\n    team: tm.teams as any,\n  }));\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 388, "column": 0}, "map": {"version":3,"sources":["file:///Users/pietromontanti/Desktop/approved-clean/Approved/app/api/cues/route.ts"],"sourcesContent":["// app/api/cues/route.ts\n/**\n * Cues API Route\n *\n * Secure implementation with:\n * - Server-side authentication verification\n * - Project access authorization checks\n * - Input validation\n * - Error handling\n * - Type safety\n */\n\nimport { NextResponse, NextRequest } from \"next/server\";\nimport { v4 as uuidv4 } from \"uuid\";\nimport { supabaseAdmin } from \"@/lib/supabaseAdmin\";\nimport { verifyAuth, canAccessProject, canModifyProject } from '@/lib/auth';\n\n// ============================================================================\n// TYPES\n// ============================================================================\n\ntype Cue = {\n  id: string;\n  project_id: string;\n  index_in_project: number;\n  original_name: string | null;\n  name: string | null;\n  display_name: string | null;\n  status: string;\n  created_at: string;\n  updated_at: string;\n};\n\n// ============================================================================\n// HELPER FUNCTIONS\n// ============================================================================\n\nconst isUuid = (value: string) =>\n  typeof value === \"string\" &&\n  /^[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(\n    value\n  );\n\n// ============================================================================\n// API ROUTES\n// ============================================================================\n\n/**\n * GET /api/cues?projectId=xxx\n *\n * Returns cues for a project\n * Requires: Authentication + project access\n * Returns: { cues: Cue[] }\n */\nexport async function GET(req: NextRequest) {\n  try {\n    console.log('[GET /api/cues] Request started');\n\n    // SECURITY: Verify authentication\n    const auth = await verifyAuth(req);\n    if (!auth) {\n      console.log('[GET /api/cues] Unauthorized request');\n      return NextResponse.json(\n        { error: 'Unauthorized - authentication required' },\n        { status: 401 }\n      );\n    }\n\n    const userId = auth.userId;\n\n    const url = new URL(req.url);\n    const projectId = url.searchParams.get('projectId');\n\n    if (!projectId) {\n      return NextResponse.json(\n        { error: 'projectId query parameter is required' },\n        { status: 400 }\n      );\n    }\n\n    if (!isUuid(projectId)) {\n      return NextResponse.json(\n        { error: 'projectId must be a valid UUID' },\n        { status: 400 }\n      );\n    }\n\n    // SECURITY: Check if user has access to this project\n    const hasAccess = await canAccessProject(userId, projectId);\n    if (!hasAccess) {\n      console.log('[GET /api/cues] User does not have access to project');\n      return NextResponse.json(\n        { error: 'Forbidden - you do not have access to this project' },\n        { status: 403 }\n      );\n    }\n\n    // Fetch cues\n    const { data: cues, error } = await supabaseAdmin\n      .from(\"cues\")\n      .select('*')\n      .eq(\"project_id\", projectId)\n      .order(\"index_in_project\", { ascending: true });\n\n    if (error) {\n      console.error(\"[GET /api/cues] Error fetching cues:\", error);\n      return NextResponse.json(\n        { error: `Failed to fetch cues: ${error.message}` },\n        { status: 500 }\n      );\n    }\n\n    console.log('[GET /api/cues] Found', cues?.length || 0, 'cues for project', projectId);\n    return NextResponse.json({ cues: cues || [] }, {\n      status: 200,\n      headers: { 'Content-Type': 'application/json' }\n    });\n\n  } catch (err: any) {\n    console.error(\"[GET /api/cues] Error:\", err);\n    return NextResponse.json(\n      { error: err?.message || 'Internal server error' },\n      { status: 500 }\n    );\n  }\n}\n\n/**\n * POST /api/cues\n *\n * Creates a new cue in a project\n * Requires: Authentication + project modify permission\n * Body: { project_id: string, cue: { name, index, status, ... } }\n * Returns: { cue: Cue, cueId: string }\n */\nexport async function POST(req: NextRequest) {\n  try {\n    console.log('[POST /api/cues] Request started');\n\n    // SECURITY: Verify authentication\n    const auth = await verifyAuth(req);\n    if (!auth) {\n      console.log('[POST /api/cues] Unauthorized request');\n      return NextResponse.json(\n        { error: 'Unauthorized - authentication required' },\n        { status: 401 }\n      );\n    }\n\n    const userId = auth.userId;\n\n    // Parse and validate request body\n    let body: any;\n    try {\n      body = await req.json();\n    } catch (err) {\n      console.error('[POST /api/cues] Invalid JSON:', err);\n      return NextResponse.json(\n        { error: 'Invalid JSON in request body' },\n        { status: 400 }\n      );\n    }\n\n    const { project_id, cue } = body;\n\n    if (!project_id || !cue) {\n      return NextResponse.json(\n        { error: \"project_id and cue are required\" },\n        { status: 400 }\n      );\n    }\n\n    if (!isUuid(project_id)) {\n      return NextResponse.json(\n        { error: \"project_id must be a valid UUID\" },\n        { status: 400 }\n      );\n    }\n\n    // SECURITY: Check if user can modify this project\n    const canModify = await canModifyProject(userId, project_id);\n    if (!canModify) {\n      console.log('[POST /api/cues] User not authorized to modify project');\n      return NextResponse.json(\n        { error: 'Forbidden - you do not have permission to modify this project' },\n        { status: 403 }\n      );\n    }\n\n    const cue_id = uuidv4();\n\n    // Create cue\n    const { data, error } = await supabaseAdmin\n      .from(\"cues\")\n      .insert({\n        id: cue_id,\n        project_id,\n        index_in_project: typeof cue.index === 'number' ? cue.index : 0,\n        original_name: cue.originalName || null,\n        name: cue.name || null,\n        display_name: cue.displayName || null,\n        status: cue.status || \"in-review\",\n      })\n      .select()\n      .single();\n\n    if (error) {\n      console.error(\"[POST /api/cues] Error creating cue:\", error);\n      return NextResponse.json(\n        { error: `Failed to create cue: ${error.message}` },\n        { status: 500 }\n      );\n    }\n\n    console.log(\"[POST /api/cues] Cue created:\", cue_id);\n    return NextResponse.json({ cue: data, cueId: cue_id }, { status: 201 });\n\n  } catch (err: any) {\n    console.error(\"[POST /api/cues] Error:\", err);\n    return NextResponse.json(\n      { error: err?.message || 'Internal server error' },\n      { status: 500 }\n    );\n  }\n}\n\n/**\n * PATCH /api/cues\n *\n * Updates a cue's name or status\n * Requires: Authentication + project modify permission\n * Body: { id: string, name?: string, status?: string }\n * Returns: { cue: Cue }\n */\nexport async function PATCH(req: NextRequest) {\n  try {\n    console.log('[PATCH /api/cues] Request started');\n\n    // SECURITY: Verify authentication\n    const auth = await verifyAuth(req);\n    if (!auth) {\n      console.log('[PATCH /api/cues] Unauthorized request');\n      return NextResponse.json(\n        { error: 'Unauthorized - authentication required' },\n        { status: 401 }\n      );\n    }\n\n    const userId = auth.userId;\n\n    // Parse and validate request body\n    let body: any;\n    try {\n      body = await req.json();\n    } catch (err) {\n      console.error('[PATCH /api/cues] Invalid JSON:', err);\n      return NextResponse.json(\n        { error: 'Invalid JSON in request body' },\n        { status: 400 }\n      );\n    }\n\n    const { id, name, status } = body;\n\n    if (!id || !isUuid(id)) {\n      return NextResponse.json(\n        { error: \"Valid cue id is required\" },\n        { status: 400 }\n      );\n    }\n\n    // Fetch cue to check project access\n    const { data: existingCue, error: fetchError } = await supabaseAdmin\n      .from(\"cues\")\n      .select('id, project_id')\n      .eq(\"id\", id)\n      .maybeSingle();\n\n    if (fetchError) {\n      console.error(\"[PATCH /api/cues] Error fetching cue:\", fetchError);\n      return NextResponse.json(\n        { error: `Failed to fetch cue: ${fetchError.message}` },\n        { status: 500 }\n      );\n    }\n\n    if (!existingCue) {\n      return NextResponse.json(\n        { error: 'Cue not found' },\n        { status: 404 }\n      );\n    }\n\n    // SECURITY: Check if user can modify the project this cue belongs to\n    const canModify = await canModifyProject(userId, existingCue.project_id);\n    if (!canModify) {\n      console.log('[PATCH /api/cues] User not authorized to modify project');\n      return NextResponse.json(\n        { error: 'Forbidden - you do not have permission to modify this cue' },\n        { status: 403 }\n      );\n    }\n\n    // Build update object\n    const updates: any = {};\n    if (name !== undefined) updates.name = name;\n    if (status !== undefined) updates.status = status;\n\n    if (Object.keys(updates).length === 0) {\n      return NextResponse.json(\n        { error: \"No fields to update\" },\n        { status: 400 }\n      );\n    }\n\n    // Update cue\n    const { data, error } = await supabaseAdmin\n      .from(\"cues\")\n      .update(updates)\n      .eq(\"id\", id)\n      .select()\n      .single();\n\n    if (error) {\n      console.error(\"[PATCH /api/cues] Error updating cue:\", error);\n      return NextResponse.json(\n        { error: `Failed to update cue: ${error.message}` },\n        { status: 500 }\n      );\n    }\n\n    console.log(\"[PATCH /api/cues] Cue updated:\", id);\n    return NextResponse.json({ cue: data }, { status: 200 });\n\n  } catch (err: any) {\n    console.error(\"[PATCH /api/cues] Error:\", err);\n    return NextResponse.json(\n      { error: err?.message || 'Internal server error' },\n      { status: 500 }\n    );\n  }\n}\n\n/**\n * DELETE /api/cues?id=xxx\n *\n * Deletes a cue and all its versions (cascade)\n * Requires: Authentication + project modify permission\n * Query: ?id=<cue_id>\n * Returns: { success: true }\n */\nexport async function DELETE(req: NextRequest) {\n  try {\n    console.log('[DELETE /api/cues] Request started');\n\n    // SECURITY: Verify authentication\n    const auth = await verifyAuth(req);\n    if (!auth) {\n      console.log('[DELETE /api/cues] Unauthorized request');\n      return NextResponse.json(\n        { error: 'Unauthorized - authentication required' },\n        { status: 401 }\n      );\n    }\n\n    const userId = auth.userId;\n\n    const url = new URL(req.url);\n    const id = url.searchParams.get('id');\n\n    if (!id || !isUuid(id)) {\n      return NextResponse.json(\n        { error: \"Valid cue id is required\" },\n        { status: 400 }\n      );\n    }\n\n    // Fetch cue to check project access\n    const { data: existingCue, error: fetchError } = await supabaseAdmin\n      .from(\"cues\")\n      .select('id, project_id')\n      .eq(\"id\", id)\n      .maybeSingle();\n\n    if (fetchError) {\n      console.error(\"[DELETE /api/cues] Error fetching cue:\", fetchError);\n      return NextResponse.json(\n        { error: `Failed to fetch cue: ${fetchError.message}` },\n        { status: 500 }\n      );\n    }\n\n    if (!existingCue) {\n      return NextResponse.json(\n        { error: 'Cue not found' },\n        { status: 404 }\n      );\n    }\n\n    // SECURITY: Check if user can modify the project this cue belongs to\n    const canModify = await canModifyProject(userId, existingCue.project_id);\n    if (!canModify) {\n      console.log('[DELETE /api/cues] User not authorized to modify project');\n      return NextResponse.json(\n        { error: 'Forbidden - you do not have permission to delete this cue' },\n        { status: 403 }\n      );\n    }\n\n    // Delete all versions of this cue first\n    const { error: versionsError } = await supabaseAdmin\n      .from(\"versions\")\n      .delete()\n      .eq(\"cue_id\", id);\n\n    if (versionsError) {\n      console.error(\"[DELETE /api/cues] Error deleting versions:\", versionsError);\n      return NextResponse.json(\n        { error: `Failed to delete cue versions: ${versionsError.message}` },\n        { status: 500 }\n      );\n    }\n\n    // Delete the cue\n    const { error } = await supabaseAdmin\n      .from(\"cues\")\n      .delete()\n      .eq(\"id\", id);\n\n    if (error) {\n      console.error(\"[DELETE /api/cues] Error deleting cue:\", error);\n      return NextResponse.json(\n        { error: `Failed to delete cue: ${error.message}` },\n        { status: 500 }\n      );\n    }\n\n    console.log(\"[DELETE /api/cues] Cue deleted:\", id);\n    return NextResponse.json({ success: true }, { status: 200 });\n\n  } catch (err: any) {\n    console.error(\"[DELETE /api/cues] Error:\", err);\n    return NextResponse.json(\n      { error: err?.message || 'Internal server error' },\n      { status: 500 }\n    );\n  }\n}\n"],"names":[],"mappings":"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"}}]
}