{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///Users/pietromontanti/Desktop/approved-clean/Approved/lib/supabaseClient.ts"],"sourcesContent":["// lib/supabaseClient.ts\nimport { createClient } from \"@supabase/supabase-js\";\n\nconst url = process.env.NEXT_PUBLIC_SUPABASE_URL;\nconst anon = process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY;\n\nif (!url || !anon) {\n  throw new Error(\n    \"[supabaseClient] Missing NEXT_PUBLIC_SUPABASE_URL or NEXT_PUBLIC_SUPABASE_ANON_KEY\"\n  );\n}\n\n// CRITICAL: This must work in browser AND server contexts\n// Server-side: just for type exports, won't actually use auth\n// Client-side: full auth with localStorage persistence\nlet supabaseInstance: any = null;\n\nexport function getSupabaseClient() {\n  // Only initialize on browser\n  if (typeof window === 'undefined') {\n    return createClient(url, anon);\n  }\n\n  if (!supabaseInstance) {\n    supabaseInstance = createClient(url, anon, {\n      auth: {\n        persistSession: true,\n        storageKey: 'approved-auth',\n        storage: window.localStorage,\n        autoRefreshToken: true,\n        detectSessionInUrl: true\n      }\n    });\n    console.log('[SupabaseClient] Initialized with persistence');\n    \n    // Make available globally\n    (window as any).supabaseClient = supabaseInstance;\n  }\n  \n  return supabaseInstance;\n}\n\n// Default export for backwards compatibility\nexport const supabase = getSupabaseClient();\n\n"],"names":[],"mappings":"AAAA,wBAAwB;;;;;;;AAGZ;AAFZ;;AAEA,MAAM;AACN,MAAM;AAEN;;AAMA,0DAA0D;AAC1D,8DAA8D;AAC9D,uDAAuD;AACvD,IAAI,mBAAwB;AAErB,SAAS;IACd,6BAA6B;IAC7B;;IAIA,IAAI,CAAC,kBAAkB;QACrB,mBAAmB,IAAA,0LAAY,EAAC,KAAK,MAAM;YACzC,MAAM;gBACJ,gBAAgB;gBAChB,YAAY;gBACZ,SAAS,OAAO,YAAY;gBAC5B,kBAAkB;gBAClB,oBAAoB;YACtB;QACF;QACA,QAAQ,GAAG,CAAC;QAEZ,0BAA0B;QACzB,OAAe,cAAc,GAAG;IACnC;IAEA,OAAO;AACT;AAGO,MAAM,WAAW"}},
    {"offset": {"line": 50, "column": 0}, "map": {"version":3,"sources":["file:///Users/pietromontanti/Desktop/approved-clean/Approved/app/components/SupabaseSyncBridge.tsx"],"sourcesContent":["\"use client\";\n\nimport { useEffect } from \"react\";\nimport { supabase } from \"@/lib/supabaseClient\";\n\nexport default function SupabaseSyncBridge() {\n  useEffect(() => {\n    // Expose Supabase client and sync functions to global scope\n    window.supabase = supabase;\n\n    window.SupabaseSync = {\n      async saveProject(project: any) {\n        try {\n          const { error } = await supabase.from(\"projects\").upsert(\n            { id: project.id, name: project.name, description: project.description || null },\n            { onConflict: \"id\" }\n          );\n          if (error) throw error;\n          console.log(\"✅ Project saved:\", project.id);\n          return true;\n        } catch (err) {\n          console.error(\"❌ Error saving project:\", err);\n          return false;\n        }\n      },\n\n      async loadProjects() {\n        try {\n          const { data, error } = await supabase\n            .from(\"projects\")\n            .select(`id, name, description, created_at, updated_at, cues(id, project_id, index_in_project, original_name, name, display_name, status, versions(id, cue_id, index_in_cue, status, media_type, media_storage_path, media_url, media_original_name, media_display_name, media_duration, media_thumbnail_path, media_thumbnail_url, media_waveform_data))`)\n            .order(\"created_at\", { ascending: true });\n          if (error) throw error;\n          console.log(\"✅ Projects loaded:\", data?.length || 0);\n          return data || [];\n        } catch (err) {\n          console.error(\"❌ Error loading projects:\", err);\n          return [];\n        }\n      },\n\n      async saveCue(projectId: string, cue: any) {\n        try {\n          const { error } = await supabase.from(\"cues\").upsert(\n            {\n              id: cue.id,\n              project_id: projectId,\n              index_in_project: cue.index || cue.indexInProject || 0,\n              original_name: cue.originalName || null,\n              name: cue.name || null,\n              display_name: cue.displayName || null,\n              status: cue.status || \"in-review\",\n            },\n            { onConflict: \"id\" }\n          );\n          if (error) throw error;\n          console.log(\"✅ Cue saved:\", cue.id);\n          return true;\n        } catch (err) {\n          console.error(\"❌ Error saving cue:\", err);\n          return false;\n        }\n      },\n\n      async saveVersion(cueId: string, version: any) {\n        try {\n          const { error } = await supabase.from(\"versions\").upsert(\n            {\n              id: version.id,\n              cue_id: cueId,\n              index_in_cue: version.index || version.indexInCue || 0,\n              status: version.status || \"in-review\",\n              media_type: version.media?.type || null,\n              media_storage_path: version.media?.storagePath || null,\n              media_url: version.media?.url || null,\n              media_original_name: version.media?.originalName || null,\n              media_display_name: version.media?.displayName || null,\n              media_duration: version.media?.duration || null,\n              media_thumbnail_path: version.media?.thumbnailPath || null,\n              media_thumbnail_url: version.media?.thumbnailUrl || null,\n            },\n            { onConflict: \"id\" }\n          );\n          if (error) throw error;\n          console.log(\"✅ Version saved:\", version.id);\n          return true;\n        } catch (err) {\n          console.error(\"❌ Error saving version:\", err);\n          return false;\n        }\n      },\n\n      async saveVersionFile(versionId: string, file: any) {\n        try {\n          const { error } = await supabase.from(\"version_files\").upsert(\n            {\n              id: file.id,\n              version_id: versionId,\n              name: file.name,\n              type: file.type || null,\n              url: file.url || null,\n              size: file.size || null,\n            },\n            { onConflict: \"id\" }\n          );\n          if (error) throw error;\n          console.log(\"✅ Version file saved:\", file.id);\n          return true;\n        } catch (err) {\n          console.error(\"❌ Error saving version file:\", err);\n          return false;\n        }\n      },\n    };\n\n    console.log(\"✅ SupabaseSync bridge initialized\");\n\n    // Trigger initialization of flow.js if already loaded\n    if (window.dispatchEvent) {\n      window.dispatchEvent(new Event(\"supabase-sync-ready\"));\n    }\n  }, []);\n\n  return null;\n}\n"],"names":[],"mappings":"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"}}]
}