(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,18566,(e,r,t)=>{r.exports=e.r(76562)},40433,e=>{"use strict";var r=e.i(43476),t=e.i(71645),i=e.i(18566);function o(){let o=(0,i.useRouter)(),n=(0,i.useParams)().token,[l,a]=(0,t.useState)(null),[s,d]=(0,t.useState)(null),[c,m]=(0,t.useState)(null),[f,u]=(0,t.useState)(!0),[h,g]=(0,t.useState)(!1),[v,p]=(0,t.useState)(""),[x,y]=(0,t.useState)(!1);(0,t.useEffect)(()=>{j()},[n]);let j=async()=>{try{if(!n||"null"===n){console.warn("[Invite] Missing or invalid token:",n),p("Invito non valido."),u(!1);return}let{getSupabaseClient:r}=await e.A(21933),t=r();a(t);let{data:{user:i}}=await t.auth.getUser();d(i);let o=await fetch(`/api/invites/details?token=${encodeURIComponent(n)}`),l=await o.json(),s=o.ok?null:l?.error||"Invite fetch failed",c=o.ok?l:null;if(s){let e=s.message||JSON.stringify(s,Object.getOwnPropertyNames(s));console.error("Error fetching invite (RPC):",e,s),p("Invito non trovato o non valido."),u(!1);return}if(!c||Array.isArray(c)&&0===c.length){p("Invito non trovato, scaduto o giÃ  utilizzato."),u(!1);return}let f=Array.isArray(c)?c[0]:c;m(f),u(!1)}catch(e){console.error("Error initializing invite:",e),p("Errore durante il caricamento dell'invito."),u(!1)}},b=async()=>{if(!s){localStorage.setItem("pending_invite",n),o.push("/login");return}if(c.email&&c.email!==s.email)return void p(`Questo invito \xe8 riservato a ${c.email}. Hai effettuato l'accesso come ${s.email}.`);g(!0),p("");try{let{data:e,error:r}=await l.rpc("accept_invite",{invite_token:n,accepting_user_id:s.id});if(r){console.error("Error accepting invite:",r),p("Errore durante l'accettazione dell'invito."),g(!1);return}if(!e.success){p(e.error||"Errore durante l'accettazione dell'invito."),g(!1);return}y(!0);try{resolvedInvite&&resolvedInvite.project_id&&localStorage.setItem("open_project",resolvedInvite.project_id)}catch(e){console.warn("[Invite] Could not set open_project",e)}setTimeout(()=>{o.push("/")},1200)}catch(e){console.error("Error accepting invite:",e),p("Errore imprevisto."),g(!1)}};if(f)return(0,r.jsx)("div",{style:{minHeight:"100vh",display:"flex",alignItems:"center",justifyContent:"center",background:"#0a0a0a",color:"#fff"},children:(0,r.jsxs)("div",{style:{textAlign:"center"},children:[(0,r.jsx)("div",{style:{fontSize:"1.5rem",marginBottom:"1rem"},children:"â³"}),(0,r.jsx)("div",{children:"Caricamento invito..."})]})});if(v&&!c)return(0,r.jsx)("div",{style:{minHeight:"100vh",display:"flex",alignItems:"center",justifyContent:"center",background:"#0a0a0a",color:"#fff"},children:(0,r.jsxs)("div",{style:{background:"#1a1a1a",padding:"2rem",borderRadius:"8px",maxWidth:"500px",width:"100%",border:"1px solid #333",textAlign:"center"},children:[(0,r.jsx)("div",{style:{fontSize:"3rem",marginBottom:"1rem"},children:"âŒ"}),(0,r.jsx)("h1",{style:{marginBottom:"1rem",color:"#ff4444"},children:"Invito non valido"}),(0,r.jsx)("p",{style:{color:"#999",marginBottom:"2rem"},children:v}),(0,r.jsx)("button",{onClick:()=>o.push("/"),style:{padding:"0.75rem 1.5rem",background:"#333",color:"#fff",border:"none",borderRadius:"4px",cursor:"pointer"},children:"Torna alla home"})]})});if(x)return(0,r.jsx)("div",{style:{minHeight:"100vh",display:"flex",alignItems:"center",justifyContent:"center",background:"#0a0a0a",color:"#fff"},children:(0,r.jsxs)("div",{style:{background:"#1a1a1a",padding:"2rem",borderRadius:"8px",maxWidth:"500px",width:"100%",border:"1px solid #333",textAlign:"center"},children:[(0,r.jsx)("div",{style:{fontSize:"3rem",marginBottom:"1rem"},children:"âœ…"}),(0,r.jsx)("h1",{style:{marginBottom:"1rem",color:"#44ff44"},children:"Invito accettato!"}),(0,r.jsx)("p",{style:{color:"#999",marginBottom:"1rem"},children:"Ora fai parte del team/progetto."}),(0,r.jsx)("p",{style:{color:"#666"},children:"Reindirizzamento in corso..."})]})});let S={owner:"Proprietario",editor:"Editor",commenter:"Commentatore",viewer:"Visualizzatore"}[c.role]||c.role;return(0,r.jsx)("div",{style:{minHeight:"100vh",display:"flex",alignItems:"center",justifyContent:"center",background:"#0a0a0a",color:"#fff"},children:(0,r.jsxs)("div",{style:{background:"#1a1a1a",padding:"2rem",borderRadius:"8px",maxWidth:"500px",width:"100%",border:"1px solid #333"},children:[(0,r.jsxs)("div",{style:{textAlign:"center",marginBottom:"2rem"},children:[(0,r.jsx)("div",{style:{fontSize:"3rem",marginBottom:"1rem"},children:"ðŸ“§"}),(0,r.jsx)("h1",{style:{marginBottom:"0.5rem"},children:"Sei stato invitato!"}),c.invited_by_email&&(0,r.jsxs)("p",{style:{color:"#999",fontSize:"0.9rem"},children:["da ",c.invited_by_email]})]}),(0,r.jsxs)("div",{style:{background:"#0a0a0a",padding:"1.5rem",borderRadius:"6px",marginBottom:"2rem",border:"1px solid #333"},children:[c.project_name&&(0,r.jsxs)("div",{style:{marginBottom:"1rem"},children:[(0,r.jsx)("div",{style:{color:"#999",fontSize:"0.85rem",marginBottom:"0.25rem"},children:"Progetto"}),(0,r.jsx)("div",{style:{fontSize:"1.1rem",fontWeight:"600"},children:c.project_name})]}),(0,r.jsxs)("div",{style:{marginBottom:"1rem"},children:[(0,r.jsx)("div",{style:{color:"#999",fontSize:"0.85rem",marginBottom:"0.25rem"},children:"Team"}),(0,r.jsx)("div",{style:{fontSize:"1.1rem"},children:c.team_name})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{style:{color:"#999",fontSize:"0.85rem",marginBottom:"0.25rem"},children:"Ruolo"}),(0,r.jsx)("div",{style:{display:"inline-block",padding:"0.25rem 0.75rem",background:"#0066ff33",color:"#0066ff",borderRadius:"4px",fontSize:"0.9rem",fontWeight:"500"},children:S})]}),c.email&&(0,r.jsx)("div",{style:{marginTop:"1rem",paddingTop:"1rem",borderTop:"1px solid #333"},children:(0,r.jsxs)("div",{style:{color:"#999",fontSize:"0.85rem"},children:["Invito riservato a: ",(0,r.jsx)("span",{style:{color:"#fff"},children:c.email})]})})]}),s?(0,r.jsxs)("div",{children:[v&&(0,r.jsx)("div",{style:{padding:"0.75rem",background:"#4d1a1a",borderRadius:"4px",color:"#ff6b6b",marginBottom:"1rem",fontSize:"0.9rem"},children:v}),(0,r.jsx)("button",{onClick:b,disabled:h,style:{width:"100%",padding:"0.75rem",background:h?"#333":"#0066ff",color:"#fff",border:"none",borderRadius:"4px",fontSize:"1rem",cursor:h?"not-allowed":"pointer",fontWeight:"500",opacity:h?.6:1},children:h?"Accettazione in corso...":"Accetta invito"}),(0,r.jsxs)("p",{style:{textAlign:"center",color:"#666",fontSize:"0.85rem",marginTop:"1rem"},children:["Accesso effettuato come ",s.email]})]}):(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{style:{color:"#999",marginBottom:"1.5rem",textAlign:"center"},children:"Effettua l'accesso per accettare l'invito"}),(0,r.jsx)("button",{onClick:b,style:{width:"100%",padding:"0.75rem",background:"#0066ff",color:"#fff",border:"none",borderRadius:"4px",fontSize:"1rem",cursor:"pointer",fontWeight:"500"},children:"Accedi per continuare"})]})]})})}e.s(["default",()=>o])},21933,e=>{e.v(r=>Promise.all(["static/chunks/5e12cd52e6f0e646.js"].map(r=>e.l(r))).then(()=>r(53210)))}]);