(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,18566,(e,o,r)=>{o.exports=e.r(76562)},89954,e=>{"use strict";var o=e.i(43476),r=e.i(71645),t=e.i(18566);function n(){let[n,i]=(0,r.useState)(""),[a,s]=(0,r.useState)(""),[l,d]=(0,r.useState)(""),[c,u]=(0,r.useState)(""),[g,p]=(0,r.useState)(!1),[m,h]=(0,r.useState)(""),[f,b]=(0,r.useState)(!1),[y,x]=(0,r.useState)(!1),[w,S]=(0,r.useState)(!1),[v,k]=(0,r.useState)(!1),[j,C]=(0,r.useState)(null),R=(0,t.useRouter)();(0,r.useEffect)(()=>{e.A(21933).then(e=>{C(e.getSupabaseClient()),console.log("[Login] Supabase client ready")});let o=new URLSearchParams(window.location.hash.substring(1)),r=new URLSearchParams(window.location.search),t=o.get("type"),n=r.get("type");("recovery"===t||"recovery"===n)&&S(!0),B()},[]);let B=async()=>{try{localStorage.getItem("approved-auth")&&(console.log("[Login] Found existing auth in localStorage"),R.push("/"))}catch(e){console.error("[Login] Error checking session:",e)}},z=async e=>{if(e.preventDefault(),!j)return void h("Supabase not ready");p(!0),h("");try{if(v){let{error:e}=await j.auth.signInWithOtp({email:n,options:{emailRedirectTo:`${window.location.origin}/`}});if(e)throw e;h("âœ‰ï¸ Controlla la tua email! Ti abbiamo inviato un link di accesso magico."),p(!1);return}if(f){let{error:e}=await j.auth.signUp({email:n,password:a,options:{emailRedirectTo:`${window.location.origin}/login`}});if(e)throw e;h("Check your email to confirm your account!")}else{console.log("[Login] Attempting sign in...");let{data:e,error:o}=await j.auth.signInWithPassword({email:n,password:a});if(o)throw console.error("[Login] Sign in error:",o.message),o;console.log("[Login] âœ… Sign in successful"),console.log("[Login] Checking localStorage...");let r=localStorage.getItem("approved-auth");console.log("[Login] Auth in localStorage:",!!r),await new Promise(e=>setTimeout(e,1e3));let t=localStorage.getItem("pending_invite");if(t){localStorage.removeItem("pending_invite"),R.push(`/invite/${t}`);return}let i=localStorage.getItem("pending_share");if(i){localStorage.removeItem("pending_share");try{let e=JSON.parse(i);if(e&&e.share_id){let o=e.token?`?token=${encodeURIComponent(e.token)}`:"";R.push(`/share/${e.share_id}${o}`);return}}catch(e){R.push(`/share/${i}`);return}}console.log("[Login] Redirecting to home"),R.push("/")}}catch(e){console.error("[Login] Error:",e),h(e.message||"Authentication failed")}finally{p(!1)}},P=async e=>{if(!j)return void h("Supabase not ready");p(!0),h("");try{let{error:o}=await j.auth.signInWithOAuth({provider:e,options:{redirectTo:`${window.location.origin}/`}});if(o)throw o}catch(o){console.error(`[Login] ${e} OAuth error:`,o),h(o.message||`${e} authentication failed`),p(!1)}},L=async e=>{if(e.preventDefault(),j){p(!0),h("");try{let{error:e}=await j.auth.resetPasswordForEmail(n,{redirectTo:`${window.location.origin}/login`});if(e)throw e;h("Check your email for the password reset link!")}catch(e){h(e.message||"Error sending reset email")}finally{p(!1)}}},I=async e=>{if(e.preventDefault(),l!==c)return void h("Passwords do not match");if(l.length<6)return void h("Password must be at least 6 characters");p(!0),h("");try{let{error:e}=await j.auth.updateUser({password:l});if(e)throw e;h("Password updated successfully! Redirecting..."),setTimeout(()=>R.push("/"),2e3)}catch(e){h(e.message||"Error updating password")}finally{p(!1)}};return(0,o.jsx)("div",{style:{minHeight:"100vh",display:"flex",alignItems:"center",justifyContent:"center",background:"#0a0a0a"},children:(0,o.jsxs)("div",{style:{background:"#1a1a1a",padding:"2rem",borderRadius:"8px",maxWidth:"400px",width:"100%",border:"1px solid #333"},children:[(0,o.jsx)("h1",{style:{marginBottom:"1.5rem",color:"#fff"},children:w?"Set New Password":y?"Reset Password":f?"Create Account":"Sign in to Approved"}),w?(0,o.jsxs)("form",{onSubmit:I,children:[(0,o.jsxs)("div",{style:{marginBottom:"1rem"},children:[(0,o.jsx)("label",{style:{display:"block",marginBottom:"0.5rem",color:"#ccc"},children:"New Password"}),(0,o.jsx)("input",{type:"password",value:l,onChange:e=>d(e.target.value),placeholder:"â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢",autoFocus:!0,autoComplete:"new-password",style:{width:"100%",padding:"0.75rem",borderRadius:"4px",border:"1px solid #333",background:"#0a0a0a",color:"#fff",fontSize:"1rem"}})]}),(0,o.jsxs)("div",{style:{marginBottom:"1rem"},children:[(0,o.jsx)("label",{style:{display:"block",marginBottom:"0.5rem",color:"#ccc"},children:"Confirm Password"}),(0,o.jsx)("input",{type:"password",value:c,onChange:e=>u(e.target.value),placeholder:"â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢",autoComplete:"new-password",style:{width:"100%",padding:"0.75rem",borderRadius:"4px",border:"1px solid #333",background:"#0a0a0a",color:"#fff",fontSize:"1rem"}})]}),(0,o.jsx)("button",{type:"submit",disabled:g,style:{width:"100%",padding:"0.75rem",background:"#0066ff",color:"#fff",border:"none",borderRadius:"4px",fontSize:"1rem",cursor:g?"not-allowed":"pointer",opacity:g?.6:1},children:g?"Updating...":"Update Password"})]}):y?(0,o.jsxs)("form",{onSubmit:L,children:[(0,o.jsxs)("div",{style:{marginBottom:"1rem"},children:[(0,o.jsx)("label",{style:{display:"block",marginBottom:"0.5rem",color:"#ccc"},children:"Email"}),(0,o.jsx)("input",{type:"email",value:n,onChange:e=>i(e.target.value),required:!0,placeholder:"you@example.com",style:{width:"100%",padding:"0.75rem",borderRadius:"4px",border:"1px solid #333",background:"#0a0a0a",color:"#fff",fontSize:"1rem"}})]}),(0,o.jsx)("button",{type:"submit",disabled:g,style:{width:"100%",padding:"0.75rem",background:"#0066ff",color:"#fff",border:"none",borderRadius:"4px",fontSize:"1rem",cursor:g?"not-allowed":"pointer",opacity:g?.6:1,marginBottom:"1rem"},children:g?"Sending...":"Send reset link"}),(0,o.jsx)("button",{onClick:()=>x(!1),style:{width:"100%",padding:"0.75rem",background:"transparent",color:"#999",border:"none",fontSize:"0.9rem",cursor:"pointer"},children:"â† Back to sign in"})]}):(0,o.jsxs)("form",{onSubmit:z,children:[(0,o.jsxs)("div",{style:{marginBottom:"1rem"},children:[(0,o.jsx)("label",{style:{display:"block",marginBottom:"0.5rem",color:"#ccc"},children:"Email"}),(0,o.jsx)("input",{type:"email",value:n,onChange:e=>i(e.target.value),required:!0,placeholder:"you@example.com",style:{width:"100%",padding:"0.75rem",borderRadius:"4px",border:"1px solid #333",background:"#0a0a0a",color:"#fff",fontSize:"1rem"}})]}),!v&&(0,o.jsxs)("div",{style:{marginBottom:"1rem"},children:[(0,o.jsx)("label",{style:{display:"block",marginBottom:"0.5rem",color:"#ccc"},children:"Password"}),(0,o.jsx)("input",{type:"password",value:a,onChange:e=>s(e.target.value),required:!0,placeholder:"â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢",minLength:6,style:{width:"100%",padding:"0.75rem",borderRadius:"4px",border:"1px solid #333",background:"#0a0a0a",color:"#fff",fontSize:"1rem"}})]}),!f&&!v&&(0,o.jsx)("div",{style:{textAlign:"right",marginBottom:"1rem"},children:(0,o.jsx)("button",{type:"button",onClick:()=>x(!0),style:{background:"transparent",color:"#0066ff",border:"none",fontSize:"0.85rem",cursor:"pointer",padding:0},children:"Forgot password?"})}),(0,o.jsx)("button",{type:"submit",disabled:g,style:{width:"100%",padding:"0.75rem",background:"#0066ff",color:"#fff",border:"none",borderRadius:"4px",fontSize:"1rem",cursor:g?"not-allowed":"pointer",opacity:g?.6:1,marginBottom:"1rem"},children:g?"Loading...":v?"Invia link magico ðŸ“§":f?"Sign up":"Sign in"}),!f&&!v&&(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"1rem",margin:"1.5rem 0"},children:[(0,o.jsx)("div",{style:{flex:1,height:"1px",background:"#333"}}),(0,o.jsx)("span",{style:{color:"#666",fontSize:"0.85rem"},children:"oppure"}),(0,o.jsx)("div",{style:{flex:1,height:"1px",background:"#333"}})]}),(0,o.jsxs)("button",{type:"button",onClick:()=>P("google"),disabled:g,style:{width:"100%",padding:"0.75rem",background:"#fff",color:"#333",border:"1px solid #ddd",borderRadius:"4px",fontSize:"0.95rem",cursor:g?"not-allowed":"pointer",marginBottom:"0.75rem",display:"flex",alignItems:"center",justifyContent:"center",gap:"0.5rem",fontWeight:"500"},children:[(0,o.jsx)("span",{children:"ðŸ”"})," Continua con Google"]}),(0,o.jsxs)("button",{type:"button",onClick:()=>P("apple"),disabled:g,style:{width:"100%",padding:"0.75rem",background:"#000",color:"#fff",border:"1px solid #333",borderRadius:"4px",fontSize:"0.95rem",cursor:g?"not-allowed":"pointer",marginBottom:"1rem",display:"flex",alignItems:"center",justifyContent:"center",gap:"0.5rem",fontWeight:"500"},children:[(0,o.jsx)("span",{})," Continua con Apple"]})]}),!f&&(0,o.jsx)("button",{type:"button",onClick:()=>k(!v),style:{width:"100%",padding:"0.75rem",background:"transparent",color:"#0066ff",border:"1px solid #0066ff",borderRadius:"4px",fontSize:"0.9rem",cursor:"pointer",marginBottom:"0.75rem"},children:v?"â† Usa password invece":"âœ¨ Accedi senza password (Magic Link)"}),(0,o.jsx)("button",{type:"button",onClick:()=>{b(!f),k(!1)},style:{width:"100%",padding:"0.75rem",background:"transparent",color:"#999",border:"none",fontSize:"0.9rem",cursor:"pointer"},children:f?"Already have an account? Sign in":"Need an account? Sign up"})]}),m&&(0,o.jsx)("div",{style:{marginTop:"1rem",padding:"0.75rem",background:m.includes("Check")||m.includes("confirm")?"#1a4d1a":"#4d1a1a",borderRadius:"4px",color:"#fff",fontSize:"0.9rem"},children:m})]})})}e.s(["default",()=>n])},21933,e=>{e.v(o=>Promise.all(["static/chunks/5e12cd52e6f0e646.js"].map(o=>e.l(o))).then(()=>o(53210)))}]);