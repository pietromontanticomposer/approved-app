module.exports=[93695,(e,t,r)=>{t.exports=e.x("next/dist/shared/lib/no-fallback-error.external.js",()=>require("next/dist/shared/lib/no-fallback-error.external.js"))},70406,(e,t,r)=>{t.exports=e.x("next/dist/compiled/@opentelemetry/api",()=>require("next/dist/compiled/@opentelemetry/api"))},18622,(e,t,r)=>{t.exports=e.x("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js",()=>require("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js"))},56704,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/work-async-storage.external.js",()=>require("next/dist/server/app-render/work-async-storage.external.js"))},32319,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/work-unit-async-storage.external.js",()=>require("next/dist/server/app-render/work-unit-async-storage.external.js"))},24725,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/after-task-async-storage.external.js",()=>require("next/dist/server/app-render/after-task-async-storage.external.js"))},66680,(e,t,r)=>{t.exports=e.x("node:crypto",()=>require("node:crypto"))},93266,e=>{"use strict";let t={randomUUID:e.i(66680).randomUUID};e.s(["default",0,t])},95638,e=>{"use strict";var t=e.i(66680);let r=new Uint8Array(256),n=r.length;function s(){return n>r.length-16&&((0,t.randomFillSync)(r),n=0),r.slice(n,n+=16)}e.s(["default",()=>s])},30901,84076,e=>{"use strict";let t=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-8][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000|ffffffff-ffff-ffff-ffff-ffffffffffff)$/i,r=function(e){return"string"==typeof e&&t.test(e)};e.s(["default",0,r],84076);let n=[];for(let e=0;e<256;++e)n.push((e+256).toString(16).slice(1));function s(e,t=0){return(n[e[t+0]]+n[e[t+1]]+n[e[t+2]]+n[e[t+3]]+"-"+n[e[t+4]]+n[e[t+5]]+"-"+n[e[t+6]]+n[e[t+7]]+"-"+n[e[t+8]]+n[e[t+9]]+"-"+n[e[t+10]]+n[e[t+11]]+n[e[t+12]]+n[e[t+13]]+n[e[t+14]]+n[e[t+15]]).toLowerCase()}e.s(["default",0,function(e,t=0){let n=s(e,t);if(!r(n))throw TypeError("Stringified UUID is invalid");return n},"unsafeStringify",()=>s],30901)},5499,e=>{"use strict";var t=e.i(93266),r=e.i(95638),n=e.i(30901);e.s(["default",0,function(e,s,a){if(t.default.randomUUID&&!s&&!e)return t.default.randomUUID();var o=e,i=a;let l=(o=o||{}).random??o.rng?.()??(0,r.default)();if(l.length<16)throw Error("Random bytes length must be >= 16");if(l[6]=15&l[6]|64,l[8]=63&l[8]|128,s){if((i=i||0)<0||i+16>s.length)throw RangeError(`UUID byte range ${i}:${i+15} is out of buffer bounds`);for(let e=0;e<16;++e)s[i+e]=l[e];return s}return(0,n.unsafeStringify)(l)}])},77583,e=>{"use strict";e.s([],13440),e.i(13440);var t=e.i(84076);let r=function(e){let r;if(!(0,t.default)(e))throw TypeError("Invalid UUID");return Uint8Array.of((r=parseInt(e.slice(0,8),16))>>>24,r>>>16&255,r>>>8&255,255&r,(r=parseInt(e.slice(9,13),16))>>>8,255&r,(r=parseInt(e.slice(14,18),16))>>>8,255&r,(r=parseInt(e.slice(19,23),16))>>>8,255&r,(r=parseInt(e.slice(24,36),16))/0x10000000000&255,r/0x100000000&255,r>>>24&255,r>>>16&255,r>>>8&255,255&r)};var n=e.i(30901),s=e.i(95638);let a={};function o(e,t,r,n,s,a,i=0){if(e.length<16)throw Error("Random bytes length must be >= 16");if(a){if(i<0||i+16>a.length)throw RangeError(`UUID byte range ${i}:${i+15} is out of buffer bounds`)}else a=new Uint8Array(16),i=0;t??=Date.now(),r??=0,n??=(e[8]<<8|e[9])&16383,s??=e.slice(10,16);let l=((0xfffffff&(t+=122192928e5))*1e4+r)%0x100000000;a[i++]=l>>>24&255,a[i++]=l>>>16&255,a[i++]=l>>>8&255,a[i++]=255&l;let u=t/0x100000000*1e4&0xfffffff;a[i++]=u>>>8&255,a[i++]=255&u,a[i++]=u>>>24&15|16,a[i++]=u>>>16&255,a[i++]=n>>>8|128,a[i++]=255&n;for(let e=0;e<6;++e)a[i++]=s[e];return a}let i=function(e,t,r){let i,l=e?._v6??!1;if(e){let t=Object.keys(e);1===t.length&&"_v6"===t[0]&&(e=void 0)}if(e)i=o(e.random??e.rng?.()??(0,s.default)(),e.msecs,e.nsecs,e.clockseq,e.node,t,r);else{var u,d,c;let e=Date.now(),n=(0,s.default)();u=a,d=e,c=n,u.msecs??=-1/0,u.nsecs??=0,d===u.msecs?(u.nsecs++,u.nsecs>=1e4&&(u.node=void 0,u.nsecs=0)):d>u.msecs?u.nsecs=0:d<u.msecs&&(u.node=void 0),u.node||(u.node=c.slice(10,16),u.node[0]|=1,u.clockseq=(c[8]<<8|c[9])&16383),u.msecs=d,i=o(n,a.msecs,a.nsecs,l?void 0:a.clockseq,l?void 0:a.node,t,r)}return t??(0,n.unsafeStringify)(i)};function l(e){var t;let s=(t="string"==typeof e?r(e):e,Uint8Array.of((15&t[6])<<4|t[7]>>4&15,(15&t[7])<<4|(240&t[4])>>4,(15&t[4])<<4|(240&t[5])>>4,(15&t[5])<<4|(240&t[0])>>4,(15&t[0])<<4|(240&t[1])>>4,(15&t[1])<<4|(240&t[2])>>4,96|15&t[2],t[3],t[8],t[9],t[10],t[11],t[12],t[13],t[14],t[15]));return"string"==typeof e?(0,n.unsafeStringify)(s):s}var u=e.i(66680);let d=function(e){return Array.isArray(e)?e=Buffer.from(e):"string"==typeof e&&(e=Buffer.from(e,"utf8")),(0,u.createHash)("md5").update(e).digest()},c="6ba7b810-9dad-11d1-80b4-00c04fd430c8",f="6ba7b811-9dad-11d1-80b4-00c04fd430c8";function p(e,t,s,a,o,i){let l="string"==typeof s?function(e){let t=new Uint8Array((e=unescape(encodeURIComponent(e))).length);for(let r=0;r<e.length;++r)t[r]=e.charCodeAt(r);return t}(s):s,u="string"==typeof a?r(a):a;if("string"==typeof a&&(a=r(a)),a?.length!==16)throw TypeError("Namespace must be array-like (16 iterable integer values, 0-255)");let d=new Uint8Array(16+l.length);if(d.set(u),d.set(l,u.length),(d=t(d))[6]=15&d[6]|e,d[8]=63&d[8]|128,o){i=i||0;for(let e=0;e<16;++e)o[i+e]=d[e];return o}return(0,n.unsafeStringify)(d)}function m(e,t,r,n){return p(48,d,e,t,r,n)}m.DNS=c,m.URL=f;var g=e.i(5499);let h=function(e){return Array.isArray(e)?e=Buffer.from(e):"string"==typeof e&&(e=Buffer.from(e,"utf8")),(0,u.createHash)("sha1").update(e).digest()};function y(e,t,r,n){return p(80,h,e,t,r,n)}function v(e){var t;let s=(t="string"==typeof e?r(e):e,Uint8Array.of((15&t[3])<<4|t[4]>>4&15,(15&t[4])<<4|(240&t[5])>>4,(15&t[5])<<4|15&t[6],t[7],(15&t[1])<<4|(240&t[2])>>4,(15&t[2])<<4|(240&t[3])>>4,16|(240&t[0])>>4,(15&t[0])<<4|(240&t[1])>>4,t[8],t[9],t[10],t[11],t[12],t[13],t[14],t[15]));return"string"==typeof e?(0,n.unsafeStringify)(s):s}y.DNS=c,y.URL=f;let x={};function R(e,t,r,n,s=0){if(e.length<16)throw Error("Random bytes length must be >= 16");if(n){if(s<0||s+16>n.length)throw RangeError(`UUID byte range ${s}:${s+15} is out of buffer bounds`)}else n=new Uint8Array(16),s=0;return t??=Date.now(),r??=127*e[6]<<24|e[7]<<16|e[8]<<8|e[9],n[s++]=t/0x10000000000&255,n[s++]=t/0x100000000&255,n[s++]=t/0x1000000&255,n[s++]=t/65536&255,n[s++]=t/256&255,n[s++]=255&t,n[s++]=112|r>>>28&15,n[s++]=r>>>20&255,n[s++]=128|r>>>14&63,n[s++]=r>>>6&255,n[s++]=r<<2&255|3&e[10],n[s++]=e[11],n[s++]=e[12],n[s++]=e[13],n[s++]=e[14],n[s++]=e[15],n}e.s(["MAX",0,"ffffffff-ffff-ffff-ffff-ffffffffffff","NIL",0,"00000000-0000-0000-0000-000000000000","parse",0,r,"stringify",()=>n.default,"v1",0,i,"v1ToV6",()=>l,"v3",0,m,"v4",()=>g.default,"v5",0,y,"v6",0,function(e,t,r){r??=0;let s=i({...e??={},_v6:!0},new Uint8Array(16));if(s=l(s),t){for(let e=0;e<16;e++)t[r+e]=s[e];return t}return(0,n.unsafeStringify)(s)},"v6ToV1",()=>v,"v7",0,function(e,t,r){let a;if(e)a=R(e.random??e.rng?.()??(0,s.default)(),e.msecs,e.seq,t,r);else{var o,i,l;let e=Date.now(),n=(0,s.default)();o=x,i=e,l=n,o.msecs??=-1/0,o.seq??=0,i>o.msecs?(o.seq=l[6]<<23|l[7]<<16|l[8]<<8|l[9],o.msecs=i):(o.seq=o.seq+1|0,0===o.seq&&o.msecs++),a=R(n,x.msecs,x.seq,t,r)}return t??(0,n.unsafeStringify)(a)},"validate",()=>t.default,"version",0,function(e){if(!(0,t.default)(e))throw TypeError("Invalid UUID");return parseInt(e.slice(14,15),16)}],77583)},44687,e=>{"use strict";var t=e.i(72195);let r="https://waaigankcctijalvlppk.supabase.co",n=process.env.SUPABASE_SERVICE_ROLE_KEY,s=null;if(r&&n)s=(0,t.createClient)(r,n,{auth:{persistSession:!1}});else if("1"===process.env.APP_ALLOW_FAKE_SUPABASE){let t={projects:[{id:"p1",team_id:"t1",owner_id:"owner-1",name:"Test Project"}],share_links:[],project_members:[],team_members:[{team_id:"t1",user_id:"owner-1",role:"owner"}],audit_logs:[]},{v4:r}=e.r(77583);s={from:e=>{let n;return n={_table:e,_select:"*",_where:[],_limit:null,select:e=>(n._select=e||"*",n),eq:(e,t)=>(n._where.push({k:e,v:t}),n),limit:e=>(n._limit=e,n),maybeSingle:async()=>{let r=(t[e]||[]).filter(e=>n._where.every(t=>String(e[t.k])===String(t.v)));return{data:r.length>0?JSON.parse(JSON.stringify(r[0])):null,error:null}},insert:n=>{let s=t[e]||(t[e]=[]),a=(Array.isArray(n)?n:[n]).map(e=>{let t=Object.assign({},e);return t.id||(t.id=r()),t.created_at=new Date().toISOString(),s.push(t),t});return{data:a,error:null,select:()=>({single:async()=>({data:a[0],error:null})})}},update:r=>({eq:async(s,a)=>{let o=t[e]||[],i=0;for(let e of o)n._where.every(t=>String(e[t.k])===String(t.v))&&String(e[s])===String(a)&&(Object.assign(e,r),i++);return{data:i>0?o.filter(e=>n._where.every(t=>String(e[t.k])===String(t.v))&&String(e[s])===String(a)):[],error:null}}}),upsert:async(n,s)=>{let a=t[e]||(t[e]=[]),o=a.find(e=>e.project_id===n.project_id&&e.member_id===n.member_id);if(o)return Object.assign(o,n),{data:[o],error:null};let i=Object.assign({},n);return i.id||(i.id=r()),a.push(i),{data:[i],error:null}},single:async()=>({data:(t[e]||[]).filter(e=>n._where.every(t=>String(e[t.k])===String(t.v)))[0]||null,error:null})}}}}else throw Error("Missing NEXT_PUBLIC_SUPABASE_URL or SUPABASE_SERVICE_ROLE_KEY in environment. Set APP_ALLOW_FAKE_SUPABASE=1 to enable a local fake client for tests.");e.s(["supabaseAdmin",()=>s])},89960,e=>{"use strict";var t=e.i(5499);e.s(["v4",()=>t.default])},45391,e=>{"use strict";var t=e.i(44687);async function r(e){if(!e)return null;let r=String(e||"").trim();if(/^Bearer\s+/i.test(r)){let e=r.split(/\s+/)[1];if(e)try{let{data:r,error:n}=await t.supabaseAdmin.auth.getUser(e);if(!n&&r?.user?.id)return r.user.id}catch(e){}}if(/^[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[1-5][0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12}$/.test(e))return e;if(e.includes("@"))try{if(t.supabaseAdmin.auth&&t.supabaseAdmin.auth.admin&&"function"==typeof t.supabaseAdmin.auth.admin.listUsers){let r=await t.supabaseAdmin.auth.admin.listUsers({search:e});if(!r.error&&r.data&&Array.isArray(r.data.users)){let t=r.data.users.find(t=>(t.email||"").toLowerCase()===e.toLowerCase());if(t)return t.id}}try{let{data:r}=await t.supabaseAdmin.from("auth.users").select("id,email").eq("email",e).limit(1).maybeSingle();if(r&&r.id)return r.id}catch(e){}}catch(e){}return null}e.s(["resolveActorId",()=>r])},28528,e=>{"use strict";var t=e.i(47909),r=e.i(74017),n=e.i(96250),s=e.i(59756),a=e.i(61916),o=e.i(14444),i=e.i(37092),l=e.i(69741),u=e.i(16795),d=e.i(87718),c=e.i(95169),f=e.i(47587),p=e.i(66012),m=e.i(70101),g=e.i(26937),h=e.i(10372),y=e.i(93695);e.i(52474);var v=e.i(5232),x=e.i(89171),R=e.i(89960),b=e.i(44687),w=e.i(45391);let A=e=>"string"==typeof e&&/^[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(e);async function E(e){try{let t=new URL(e.url).searchParams.get("versionId");if(!t)return x.NextResponse.json({error:"versionId required"},{status:400});let{data:r,error:n}=await b.supabaseAdmin.from("comments").select("*").eq("version_id",t).order("created_at",{ascending:!0});if(n)return console.error("[GET /api/comments] Error:",n),x.NextResponse.json({error:n.message},{status:500});return x.NextResponse.json({comments:r||[]},{status:200})}catch(e){return console.error("[GET /api/comments] Exception:",e),x.NextResponse.json({error:e.message},{status:500})}}async function _(e){try{let t=await e.json();console.log("[POST /api/comments] incoming body:",t);let{version_id:r,time_seconds:n,author:s,text:a}=t;if(!r||void 0===n||!a)return x.NextResponse.json({error:"version_id, time_seconds, and text are required"},{status:400});if(!A(r))return x.NextResponse.json({error:"version_id must be a UUID"},{status:400});let o=s||null,i=null;try{let t=e.headers?.get&&(e.headers.get("x-actor-id")||e.headers.get("x-actor"))||null;if(t){let e=await (0,w.resolveActorId)(t);if(e&&(i=e,!o))try{let{data:t}=await b.supabaseAdmin.from("auth.users").select("id, user_metadata").eq("id",e).maybeSingle();if(t&&t.user_metadata){let e=t.user_metadata,r=e.first_name||e.firstName||e.first||"",n=e.last_name||e.lastName||e.last||"",s=e.display_name||e.full_name||`${r} ${n}`.trim();s&&(o=s)}}catch(e){}}}catch(e){}let l=(0,R.v4)();try{let t=e.headers?.get&&(e.headers.get("x-actor-id")||e.headers.get("x-actor"))||null;console.log("[POST /api/comments] actor header:",t,"resolvedActorUid (pre-insert):",i)}catch(e){}let u=null,d=null;try{let e=await b.supabaseAdmin.from("comments").insert({id:l,version_id:r,time_seconds:n,author:o||"Client",actor_id:i,text:a}).select().single();u=e.data,d=e.error}catch(e){d=e}if(d){let e=d&&(d.message||d.error_description||String(d))||"";if(e.toLowerCase().includes("actor_id")||e.toLowerCase().includes("schema cache"))try{let e=await b.supabaseAdmin.from("comments").insert({id:l,version_id:r,time_seconds:n,author:o||"Client",text:a}).select().single();u=e.data,d=e.error}catch(e){d=e}}if(d)return console.error("[POST /api/comments] Supabase error",d),x.NextResponse.json({error:d.message||JSON.stringify(d)},{status:500});return console.log("[POST /api/comments] inserted comment:",u),x.NextResponse.json({comment:u},{status:201})}catch(e){return console.error("[POST /api/comments] Error",e),x.NextResponse.json({error:e.message||"Internal error"},{status:500})}}async function S(e){try{let{id:t,text:r}=await e.json();if(!t||!r)return x.NextResponse.json({error:"id and text are required"},{status:400});if(!A(t))return x.NextResponse.json({error:"id must be a UUID"},{status:400});let n=e.headers?.get&&(e.headers.get("x-actor-id")||e.headers.get("x-actor"))||null,s=n?await (0,w.resolveActorId)(n):null,{data:a,error:o}=await b.supabaseAdmin.from("comments").select("id, actor_id").eq("id",t).maybeSingle();if(o)return console.error("[PATCH /api/comments] Error fetching comment",o),x.NextResponse.json({error:o.message||"Error fetching comment"},{status:500});if(!a)return x.NextResponse.json({error:"Comment not found"},{status:404});if(!a.actor_id)return x.NextResponse.json({error:"Comment does not have an actor_id; run migrations/backfill to enable edits/deletes"},{status:403});if(!s||s!==a.actor_id)return x.NextResponse.json({error:"Not authorized to edit this comment"},{status:403});let{data:i,error:l}=await b.supabaseAdmin.from("comments").update({text:r}).eq("id",t).select().single();if(l)return console.error("[PATCH /api/comments] Supabase error",l),x.NextResponse.json({error:l.message},{status:500});return x.NextResponse.json({comment:i},{status:200})}catch(e){return console.error("[PATCH /api/comments] Error",e),x.NextResponse.json({error:e.message||"Internal error"},{status:500})}}async function U(e){try{let{searchParams:t}=new URL(e.url),r=t.get("id");if(!r)return x.NextResponse.json({error:"id query parameter is required"},{status:400});if(!A(r))return x.NextResponse.json({error:"id must be a UUID"},{status:400});let n=e.headers?.get&&(e.headers.get("x-actor-id")||e.headers.get("x-actor"))||null,s=n?await (0,w.resolveActorId)(n):null,{data:a,error:o}=await b.supabaseAdmin.from("comments").select("id, actor_id").eq("id",r).maybeSingle();if(o)return console.error("[DELETE /api/comments] Error fetching comment",o),x.NextResponse.json({error:o.message||"Error fetching comment"},{status:500});if(!a)return x.NextResponse.json({error:"Comment not found"},{status:404});if(!a.actor_id)return x.NextResponse.json({error:"Comment does not have an actor_id; run migrations/backfill to enable edits/deletes"},{status:403});if(!s||s!==a.actor_id)return x.NextResponse.json({error:"Not authorized to delete this comment"},{status:403});let{error:i}=await b.supabaseAdmin.from("comments").delete().eq("id",r);if(i)return console.error("[DELETE /api/comments] Supabase error",i),x.NextResponse.json({error:i.message},{status:500});return x.NextResponse.json({success:!0},{status:200})}catch(e){return console.error("[DELETE /api/comments] Error",e),x.NextResponse.json({error:e.message||"Internal error"},{status:500})}}e.s(["DELETE",()=>U,"GET",()=>E,"PATCH",()=>S,"POST",()=>_],71673);var N=e.i(71673);let j=new t.AppRouteRouteModule({definition:{kind:r.RouteKind.APP_ROUTE,page:"/api/comments/route",pathname:"/api/comments",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/app/api/comments/route.ts",nextConfigOutput:"",userland:N}),{workAsyncStorage:C,workUnitAsyncStorage:I,serverHooks:T}=j;function q(){return(0,n.patchFetch)({workAsyncStorage:C,workUnitAsyncStorage:I})}async function P(e,t,n){j.isDev&&(0,s.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let x="/api/comments/route";x=x.replace(/\/index$/,"")||"/";let R=await j.prepare(e,t,{srcPage:x,multiZoneDraftMode:!1});if(!R)return t.statusCode=400,t.end("Bad Request"),null==n.waitUntil||n.waitUntil.call(n,Promise.resolve()),null;let{buildId:b,params:w,nextConfig:A,parsedUrl:E,isDraftMode:_,prerenderManifest:S,routerServerContext:U,isOnDemandRevalidate:N,revalidateOnlyGenerated:C,resolvedPathname:I,clientReferenceManifest:T,serverActionsManifest:q}=R,P=(0,l.normalizeAppPath)(x),O=!!(S.dynamicRoutes[P]||S.routes[I]),D=async()=>((null==U?void 0:U.render404)?await U.render404(e,t,E,!1):t.end("This page could not be found"),null);if(O&&!_){let e=!!S.routes[I],t=S.dynamicRoutes[P];if(t&&!1===t.fallback&&!e){if(A.experimental.adapterPath)return await D();throw new y.NoFallbackError}}let k=null;!O||j.isDev||_||(k="/index"===(k=I)?"/":k);let L=!0===j.isDev||!O,H=O&&!L;q&&T&&(0,o.setReferenceManifestsSingleton)({page:x,clientReferenceManifest:T,serverActionsManifest:q,serverModuleMap:(0,i.createServerModuleMap)({serverActionsManifest:q})});let $=e.method||"GET",M=(0,a.getTracer)(),B=M.getActiveScopeSpan(),F={params:w,prerenderManifest:S,renderOpts:{experimental:{authInterrupts:!!A.experimental.authInterrupts},cacheComponents:!!A.cacheComponents,supportsDynamicResponse:L,incrementalCache:(0,s.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:A.cacheLife,waitUntil:n.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,r,n)=>j.onRequestError(e,t,n,U)},sharedContext:{buildId:b}},K=new u.NodeNextRequest(e),V=new u.NodeNextResponse(t),G=d.NextRequestAdapter.fromNodeNextRequest(K,(0,d.signalFromNodeResponse)(t));try{let o=async e=>j.handle(G,F).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let r=M.getRootSpanAttributes();if(!r)return;if(r.get("next.span_type")!==c.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${r.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let n=r.get("next.route");if(n){let t=`${$} ${n}`;e.setAttributes({"next.route":n,"http.route":n,"next.span_name":t}),e.updateName(t)}else e.updateName(`${$} ${x}`)}),i=!!(0,s.getRequestMeta)(e,"minimalMode"),l=async s=>{var a,l;let u=async({previousCacheEntry:r})=>{try{if(!i&&N&&C&&!r)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let a=await o(s);e.fetchMetrics=F.renderOpts.fetchMetrics;let l=F.renderOpts.pendingWaitUntil;l&&n.waitUntil&&(n.waitUntil(l),l=void 0);let u=F.renderOpts.collectedTags;if(!O)return await (0,p.sendResponse)(K,V,a,F.renderOpts.pendingWaitUntil),null;{let e=await a.blob(),t=(0,m.toNodeOutgoingHttpHeaders)(a.headers);u&&(t[h.NEXT_CACHE_TAGS_HEADER]=u),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let r=void 0!==F.renderOpts.collectedRevalidate&&!(F.renderOpts.collectedRevalidate>=h.INFINITE_CACHE)&&F.renderOpts.collectedRevalidate,n=void 0===F.renderOpts.collectedExpire||F.renderOpts.collectedExpire>=h.INFINITE_CACHE?void 0:F.renderOpts.collectedExpire;return{value:{kind:v.CachedRouteKind.APP_ROUTE,status:a.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:r,expire:n}}}}catch(t){throw(null==r?void 0:r.isStale)&&await j.onRequestError(e,t,{routerKind:"App Router",routePath:x,routeType:"route",revalidateReason:(0,f.getRevalidateReason)({isStaticGeneration:H,isOnDemandRevalidate:N})},U),t}},d=await j.handleResponse({req:e,nextConfig:A,cacheKey:k,routeKind:r.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:S,isRoutePPREnabled:!1,isOnDemandRevalidate:N,revalidateOnlyGenerated:C,responseGenerator:u,waitUntil:n.waitUntil,isMinimalMode:i});if(!O)return null;if((null==d||null==(a=d.value)?void 0:a.kind)!==v.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==d||null==(l=d.value)?void 0:l.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});i||t.setHeader("x-nextjs-cache",N?"REVALIDATED":d.isMiss?"MISS":d.isStale?"STALE":"HIT"),_&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let c=(0,m.fromNodeOutgoingHttpHeaders)(d.value.headers);return i&&O||c.delete(h.NEXT_CACHE_TAGS_HEADER),!d.cacheControl||t.getHeader("Cache-Control")||c.get("Cache-Control")||c.set("Cache-Control",(0,g.getCacheControlHeader)(d.cacheControl)),await (0,p.sendResponse)(K,V,new Response(d.value.body,{headers:c,status:d.value.status||200})),null};B?await l(B):await M.withPropagatedContext(e.headers,()=>M.trace(c.BaseServerSpan.handleRequest,{spanName:`${$} ${x}`,kind:a.SpanKind.SERVER,attributes:{"http.method":$,"http.target":e.url}},l))}catch(t){if(t instanceof y.NoFallbackError||await j.onRequestError(e,t,{routerKind:"App Router",routePath:P,routeType:"route",revalidateReason:(0,f.getRevalidateReason)({isStaticGeneration:H,isOnDemandRevalidate:N})}),O)throw t;return await (0,p.sendResponse)(K,V,new Response(null,{status:500})),null}}e.s(["handler",()=>P,"patchFetch",()=>q,"routeModule",()=>j,"serverHooks",()=>T,"workAsyncStorage",()=>C,"workUnitAsyncStorage",()=>I],28528)}];

//# sourceMappingURL=%5Broot-of-the-server%5D__a86f53e4._.js.map